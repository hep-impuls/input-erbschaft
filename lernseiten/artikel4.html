<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artikel: Wo wohnen die Superreichen? - hep Verlag</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #003876 0%, #5eb9b4 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #003876;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .article-link {
            background: #f8f9fa;
            border-left: 4px solid #5eb9b4;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .article-link h2 {
            color: #003876;
            margin-bottom: 10px;
        }

        .article-link a {
            display: inline-block;
            background: #5eb9b4;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .article-link a:hover {
            background: #4a9a95;
        }

        /* === ZITATE-SLIDESHOW === */
        .quotes-section {
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            position: relative;
            min-height: 400px;
        }

        .quotes-section h2 {
            color: #003876;
            margin-bottom: 20px;
            text-align: center;
        }

        .slide {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .slide.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            border-left: 5px solid #5eb9b4;
            min-height: 250px;
        }

        .slide-title {
            font-size: 1.5em;
            color: #003876;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .slide-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #333;
            margin-bottom: 15px;
        }

        .slide-highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .slide-quote {
            background: #f0f8f0;
            border-left: 5px solid #5eb9b4;
            padding: 20px;
            margin: 15px 0;
            font-style: italic;
            border-radius: 5px;
        }

        .slide-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #003876, #5eb9b4);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .slide-progress {
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: #003876;
        }

        .slide-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        .slide-btn {
            background: #5eb9b4;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .slide-btn:hover {
            background: #4a9a95;
        }

        .slide-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* === INTERAKTIVE AKTIVIT√ÑTEN === */
        .interactive-section {
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .interactive-section.unlocked {
            display: block;
        }

        .interactive-section h2 {
            color: #003876;
            margin-bottom: 20px;
            text-align: center;
        }

        .activity-progress {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            color: #003876;
        }

        /* Kantons-Ranking */
        .ranking-game {
            margin-top: 25px;
        }

        .canton-pool {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        .canton-chip {
            background: linear-gradient(135deg, #003876, #5eb9b4);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            text-align: center;
            cursor: move;
            font-weight: 600;
            transition: all 0.3s;
            user-select: none;
        }

        .canton-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .canton-chip.dragging {
            opacity: 0.5;
        }

        .canton-chip.placed {
            background: #4caf50;
            cursor: default;
        }

        .ranking-drops {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .drop-zone {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: white;
            border: 3px dashed #e0e0e0;
            border-radius: 10px;
            min-height: 80px;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            border-color: #5eb9b4;
            background: #e8f4f8;
        }

        .drop-zone.correct {
            border-color: #4caf50;
            background: #e8f5e9;
            border-style: solid;
        }

        .drop-zone.incorrect {
            border-color: #f44336;
            background: #ffebee;
            border-style: solid;
        }

        .drop-zone-position {
            font-size: 1.5em;
            font-weight: bold;
            color: #003876;
            min-width: 80px;
        }

        .drop-zone-content {
            flex: 1;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .check-btn {
            background: #5eb9b4;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .check-btn:hover {
            background: #4a9a95;
            transform: translateY(-2px);
        }

        .check-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .activity-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .activity-feedback.show {
            display: block;
        }

        .activity-feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .activity-feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        /* Zahlen-Matching */
        .matching-game {
            margin-top: 25px;
        }

        .matching-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .matching-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .matching-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .matching-card.selected {
            border-color: #5eb9b4;
            background: #e8f4f8;
        }

        .matching-card.correct {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .matching-card.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .matching-number {
            font-size: 2em;
            font-weight: bold;
            color: #003876;
            text-align: center;
            margin-bottom: 10px;
        }

        .matching-question {
            font-size: 1em;
            text-align: center;
            color: #666;
        }

        /* Faktencheck */
        .facts-section {
            display: none;
        }

        .facts-section.unlocked {
            display: block;
        }

        .fact-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .fact-statement {
            font-size: 1.15em;
            margin-bottom: 20px;
            color: #003876;
            font-weight: 600;
            line-height: 1.6;
        }

        .fact-buttons {
            display: flex;
            gap: 15px;
        }

        .fact-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .fact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .fact-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .fact-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .fact-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .fact-feedback.show {
            display: block;
        }

        .fact-feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .fact-feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        /* === QUIZ (GESPERRT) === */
        .quiz-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 3px solid #5eb9b4;
            position: relative;
        }

        .quiz-section.locked {
            opacity: 0.5;
            pointer-events: none;
        }

        .quiz-lock-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 56, 118, 0.95);
            color: white;
            padding: 30px 40px;
            border-radius: 10px;
            text-align: center;
            z-index: 10;
            display: none;
        }

        .quiz-section.locked .quiz-lock-overlay {
            display: block;
        }

        .quiz-section h2 {
            color: #003876;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .question {
            background: #f8f9fa;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .question.active {
            display: block;
        }

        .question.answered {
            border-color: #5eb9b4;
        }

        .question h3 {
            color: #003876;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            background: white;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #5eb9b4;
            transform: translateX(5px);
        }

        .option.selected {
            background: #5eb9b4;
            color: white;
            border-color: #5eb9b4;
        }

        .option.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .option.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .next-button {
            background: #003876;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 1em;
            transition: background 0.3s;
            display: none;
        }

        .next-button.show {
            display: inline-block;
        }

        .next-button:hover {
            background: #002855;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #003876, #5eb9b4);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            color: #003876;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .unlock-badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .nav-button {
            background: #5eb9b4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }

        .nav-button:hover {
            background: #4a9a95;
        }

        .nav-button.secondary {
            background: #003876;
        }

        .nav-button.secondary:hover {
            background: #002855;
        }

        .completion-message {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 30px;
            display: none;
        }

        .completion-message.show {
            display: block;
        }

        .completion-message h3 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .slide-stats, .canton-pool, .matching-grid {
                grid-template-columns: 1fr;
            }

            .fact-buttons {
                flex-direction: column;
            }

            .navigation {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Artikel: Wo wohnen die Superreichen?</h1>
            <p>Hier wohnen die Superreichen, die sich vor den Juso f√ºrchten</p>
        </div>

        <div class="content">
            <div class="article-link">
                <h2>üìÑ Originalartikel</h2>
                <p><strong>Autor:</strong> Mischa Aebi</p>
                <p><strong>Thema:</strong> Erstmals Auswertung f√ºr die gesamte Schweiz ‚Äì wo die rund 2800 von der Juso-Initiative betroffenen Multimillion√§re wohnen</p>
                <a href="https://www.tagesanzeiger.ch/auswertung-zeigt-erstmals-wo-die-250-reichsten-schweizer-wohnen-110651171951" target="_blank">Artikel im Original lesen (freiwillig) ‚Üí</a>
            </div>

            <!-- === ZITATE-SLIDESHOW === -->
            <div class="quotes-section">
                <h2>üìñ Kernaussagen des Artikels</h2>
                <div class="slide-progress" id="slide-progress">Seite 1 von 8</div>

                <!-- Slide 1 -->
                <div class="slide active" data-slide="1">
                    <div class="slide-content">
                        <div class="slide-title">üá®üá≠ Die Superreichen der Schweiz</div>
                        <div class="slide-text">
                            In der Schweiz leben rund <strong>2800 Personen mit einem Verm√∂gen von √ºber 50 Millionen Franken</strong> ‚Äì genau jene, die von der Juso-Initiative betroffen w√§ren.
                        </div>
                        <div class="slide-stats">
                            <div class="stat-box">
                                <div class="stat-number">2800</div>
                                <div class="stat-label">Superreiche in der Schweiz</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number">500 Mrd.</div>
                                <div class="stat-label">CHF Gesamtverm√∂gen</div>
                            </div>
                        </div>
                        <div class="slide-highlight">
                            <strong>Entwicklung:</strong> Von 760 Superreichen im Jahr 2005 auf √ºber 2500 im Jahr 2021 ‚Äì eine <strong>Verdreifachung</strong> in nur 16 Jahren!
                        </div>
                    </div>
                </div>

                <!-- Slide 2 -->
                <div class="slide" data-slide="2">
                    <div class="slide-content">
                        <div class="slide-title">üèîÔ∏è Hergiswil NW ‚Äì Das Million√§rsdorf</div>
                        <div class="slide-text">
                            In Hergiswil mit 6'300 Einwohnern leben <strong>59 Superreiche</strong>. Das bedeutet: <strong>Jeder hundertste Einwohner</strong> besitzt mindestens 50 Millionen Franken!
                        </div>
                        <div class="slide-quote">
                            ¬´Wenn alle Betroffenen wegziehen, m√ºssten wir die Steuern theoretisch verdoppeln. Wer heute 20'000 Franken zahlt, m√ºsste k√ºnftig 40'000 Franken aufbringen.¬ª
                            <br><br><strong>‚Äî Daniel Rogenmoser, Gemeindepr√§sident Hergiswil</strong>
                        </div>
                    </div>
                </div>

                <!-- Slide 3 -->
                <div class="slide" data-slide="3">
                    <div class="slide-content">
                        <div class="slide-title">üèÜ Kantone mit h√∂chster Superreichen-Dichte</div>
                        <div class="slide-text">
                            Pro 10'000 Einwohner haben folgende Kantone die meisten Superreichen:
                        </div>
                        <div class="slide-stats">
                            <div class="stat-box">
                                <div class="stat-number">ü•á 22</div>
                                <div class="stat-label">Nidwalden</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number">ü•à 18</div>
                                <div class="stat-label">Schwyz</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number">ü•â 18</div>
                                <div class="stat-label">Zug</div>
                            </div>
                        </div>
                        <div class="slide-highlight">
                            Zum Vergleich: Aargau, Freiburg, Jura und Neuenburg haben weniger als 1 Superreichen pro 10'000 Einwohner.
                        </div>
                    </div>
                </div>

                <!-- Slide 4 -->
                <div class="slide" data-slide="4">
                    <div class="slide-content">
                        <div class="slide-title">üí∞ Bedeutung f√ºr die Steuereinnahmen</div>
                        <div class="slide-text">
                            Die 2800 Superreichen zahlen schweizweit:
                        </div>
                        <div class="slide-stats">
                            <div class="stat-box">
                                <div class="stat-number">27%</div>
                                <div class="stat-label">der Verm√∂genssteuern</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number">3,1%</div>
                                <div class="stat-label">der Einkommenssteuern</div>
                            </div>
                        </div>
                        <div class="slide-highlight">
                            <strong>Kanton Zug (250 Superreiche):</strong><br>
                            ‚Ä¢ 55% der Verm√∂genssteuern<br>
                            ‚Ä¢ 15% der Einkommenssteuern
                        </div>
                    </div>
                </div>

                <!-- Slide 5 -->
                <div class="slide" data-slide="5">
                    <div class="slide-content">
                        <div class="slide-title">‚ö†Ô∏è Der Exodus hat bereits begonnen</div>
                        <div class="slide-quote">
                            <strong>Michele Bl√∂chliger, Finanzdirektorin Nidwalden:</strong><br>
                            Erste sind ¬´mit explizitem Verweis auf die Juso-Initiative¬ª weggezogen. Seit Monaten bleiben verm√∂gende Neuzuz√ºger aus dem Ausland aus.
                        </div>
                        <div class="slide-quote">
                            <strong>Markus Beeler, Steuerverwaltung Schwyz:</strong><br>
                            20 Jahre lang Jahr f√ºr Jahr Zuwachs von potenten Steuerzahlern. Seit 2 Jahren: ¬´kaum noch Zuz√ºger in diesen h√∂chsten Verm√∂gensklassen¬ª.
                        </div>
                    </div>
                </div>

                <!-- Slide 6 -->
                <div class="slide" data-slide="6">
                    <div class="slide-content">
                        <div class="slide-title">üòä Nur Zug lacht noch</div>
                        <div class="slide-quote">
                            ¬´Trotz aller Bef√ºrchtungen im Zusammenhang mit der Erbschaftssteuerinitiative¬ª seien in Zug keine verm√∂genden Personen weggezogen. <strong>¬´Im Gegenteil. Wir verzeichneten weiterhin einen Zuwachs an Steuerzahlern mit sehr grossem Verm√∂gen.¬ª</strong>
                            <br><br>Er k√∂nne sich selber nicht erkl√§ren, warum das ¬´Interesse von reichen Ausl√§ndern an unserem Kanton ungebrochen hoch¬ª sei.
                            <br><br><strong>‚Äî Heinz T√§nnler, Zuger Finanzdirektor</strong>
                        </div>
                    </div>
                </div>

                <!-- Slide 7 -->
                <div class="slide" data-slide="7">
                    <div class="slide-content">
                        <div class="slide-title">üìâ Drohende Steuerausf√§lle</div>
                        <div class="slide-quote">
                            Z√ºrich w√ºrde nach einer Annahme der Initiative laut Berechnungen <strong>340 Millionen Franken weniger</strong> an Steuern einnehmen. Das entspricht ungef√§hr 10 Prozent der Einkommenssteuern von nat√ºrlichen Personen.
                            <br><br><strong>‚Äî Reto F√∂llmi, Professor f√ºr Volkswirtschaftslehre, Uni St. Gallen</strong>
                        </div>
                    </div>
                </div>

                <!-- Slide 8 -->
                <div class="slide" data-slide="8">
                    <div class="slide-content">
                        <div class="slide-title">üéØ Zwei gegens√§tzliche Positionen</div>
                        <div class="slide-quote">
                            ¬´Mitten vor unseren Augen entsteht gerade nichts weniger als eine neue Oligarchie. Die Konzentration von Geld und Macht bei wenigen f√ºhrt zu Gewalt und gef√§hrdet die Freiheit.¬ª
                            <br><br><strong>‚Äî C√©dric Wermuth, SP-Co-Pr√§sident</strong>
                        </div>
                        <div class="slide-quote">
                            Der ¬´rasante Anstieg¬ª der Verm√∂gen zeige, dass Superreiche nicht richtig besteuert werden. Resultat: Mittelstandsfamilien zahlen teilweise prozentual mehr als Multimillion√§re.
                            <br><br><strong>‚Äî Mirjam Hostetmann, Juso-Pr√§sidentin</strong>
                        </div>
                    </div>
                </div>

                <div class="slide-nav">
                    <button class="slide-btn" id="prev-slide" onclick="changeSlide(-1)" disabled>‚Üê Zur√ºck</button>
                    <button class="slide-btn" id="next-slide" onclick="changeSlide(1)">Weiter ‚Üí</button>
                </div>
            </div>

            <!-- === SCHRITT 1: KANTONS-RANKING === -->
            <div class="interactive-section" id="ranking-section">
                <h2>üìä Schritt 1: Kantons-Ranking</h2>
                <p style="text-align: center; margin-bottom: 20px;">Ordnen Sie die Kantone nach ihrer Multimillion√§rs-Dichte (pro 10'000 Einwohner). Ziehen Sie die Kantone von oben (h√∂chste Dichte) nach unten.</p>
                <div class="activity-progress" id="ranking-progress">0 von 6 Kantonen zugeordnet</div>
                
                <div class="ranking-game">
                    <div class="canton-pool" id="canton-pool">
                        <div class="canton-chip" draggable="true" data-canton="nidwalden" data-rank="1">Nidwalden (22)</div>
                        <div class="canton-chip" draggable="true" data-canton="schwyz" data-rank="2">Schwyz (18)</div>
                        <div class="canton-chip" draggable="true" data-canton="zug" data-rank="3">Zug (18)</div>
                        <div class="canton-chip" draggable="true" data-canton="basel" data-rank="4">Basel-Stadt (4)</div>
                        <div class="canton-chip" draggable="true" data-canton="genf" data-rank="5">Genf (3)</div>
                        <div class="canton-chip" draggable="true" data-canton="aargau" data-rank="6">Aargau (<1)</div>
                    </div>

                    <div class="ranking-drops">
                        <div class="drop-zone" data-rank="1">
                            <div class="drop-zone-position">ü•á Platz 1</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-rank="2">
                            <div class="drop-zone-position">ü•à Platz 2</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-rank="3">
                            <div class="drop-zone-position">ü•â Platz 3</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-rank="4">
                            <div class="drop-zone-position">4Ô∏è‚É£ Platz 4</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-rank="5">
                            <div class="drop-zone-position">5Ô∏è‚É£ Platz 5</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-rank="6">
                            <div class="drop-zone-position">6Ô∏è‚É£ Platz 6</div>
                            <div class="drop-zone-content"></div>
                        </div>
                    </div>

                    <button class="check-btn" id="check-ranking" onclick="checkRanking()">√úberpr√ºfen</button>
                    <div class="activity-feedback" id="ranking-feedback"></div>
                </div>
            </div>

            <!-- === SCHRITT 2: ZAHLEN ZUORDNEN === -->
            <div class="interactive-section" id="matching-section">
                <h2>üî¢ Schritt 2: Zahlen zuordnen</h2>
                <p style="text-align: center; margin-bottom: 20px;">Welche Zahl geh√∂rt wozu? Klicken Sie auf die richtige Karte.</p>
                <div class="activity-progress" id="matching-progress">0 von 4 Fragen beantwortet</div>

                <!-- Frage 1 -->
                <div style="margin-bottom: 30px;">
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-weight: 600;">
                        Wie viele Superreiche leben in Hergiswil (6'300 Einwohner)?
                    </div>
                    <div class="matching-grid">
                        <div class="matching-card" data-question="1" data-answer="wrong">
                            <div class="matching-number">30</div>
                            <div class="matching-question">Personen</div>
                        </div>
                        <div class="matching-card" data-question="1" data-answer="correct">
                            <div class="matching-number">59</div>
                            <div class="matching-question">Personen</div>
                        </div>
                        <div class="matching-card" data-question="1" data-answer="wrong">
                            <div class="matching-number">100</div>
                            <div class="matching-question">Personen</div>
                        </div>
                    </div>
                    <div class="activity-feedback" id="matching-feedback-1"></div>
                </div>

                <!-- Frage 2 -->
                <div style="margin-bottom: 30px;">
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-weight: 600;">
                        Wie viel Prozent der Verm√∂genssteuern zahlen die 2800 Superreichen schweizweit?
                    </div>
                    <div class="matching-grid">
                        <div class="matching-card" data-question="2" data-answer="wrong">
                            <div class="matching-number">15%</div>
                            <div class="matching-question">der Verm√∂genssteuern</div>
                        </div>
                        <div class="matching-card" data-question="2" data-answer="correct">
                            <div class="matching-number">27%</div>
                            <div class="matching-question">der Verm√∂genssteuern</div>
                        </div>
                        <div class="matching-card" data-question="2" data-answer="wrong">
                            <div class="matching-number">50%</div>
                            <div class="matching-question">der Verm√∂genssteuern</div>
                        </div>
                    </div>
                    <div class="activity-feedback" id="matching-feedback-2"></div>
                </div>

                <!-- Frage 3 -->
                <div style="margin-bottom: 30px;">
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-weight: 600;">
                        Mit welchen Steuerausf√§llen m√ºsste Z√ºrich bei Annahme der Initiative rechnen?
                    </div>
                    <div class="matching-grid">
                        <div class="matching-card" data-question="3" data-answer="wrong">
                            <div class="matching-number">200 Mio.</div>
                            <div class="matching-question">CHF Steuerausf√§lle</div>
                        </div>
                        <div class="matching-card" data-question="3" data-answer="correct">
                            <div class="matching-number">340 Mio.</div>
                            <div class="matching-question">CHF Steuerausf√§lle</div>
                        </div>
                        <div class="matching-card" data-question="3" data-answer="wrong">
                            <div class="matching-number">500 Mio.</div>
                            <div class="matching-question">CHF Steuerausf√§lle</div>
                        </div>
                    </div>
                    <div class="activity-feedback" id="matching-feedback-3"></div>
                </div>

                <!-- Frage 4 -->
                <div style="margin-bottom: 30px;">
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-weight: 600;">
                        Um wie viel haben sich die Superreichen in der Schweiz zwischen 2005 und 2021 vermehrt?
                    </div>
                    <div class="matching-grid">
                        <div class="matching-card" data-question="4" data-answer="wrong">
                            <div class="matching-number">Verdoppelt</div>
                            <div class="matching-question">von 760 auf ~1500</div>
                        </div>
                        <div class="matching-card" data-question="4" data-answer="correct">
                            <div class="matching-number">Verdreifacht</div>
                            <div class="matching-question">von 760 auf 2500</div>
                        </div>
                        <div class="matching-card" data-question="4" data-answer="wrong">
                            <div class="matching-number">Vervierfacht</div>
                            <div class="matching-question">von 760 auf 3000</div>
                        </div>
                    </div>
                    <div class="activity-feedback" id="matching-feedback-4"></div>
                </div>
            </div>

            <!-- === SCHRITT 3: FAKTENCHECK === -->
            <div class="interactive-section facts-section" id="facts-section">
                <h2>‚úÖ Schritt 3: Faktencheck</h2>
                <p style="text-align: center; margin-bottom: 20px;">Richtig oder falsch? Entscheiden Sie bei den folgenden Aussagen.</p>
                <div class="activity-progress" id="facts-progress">0 von 4 Aussagen beantwortet</div>

                <div class="fact-card" data-fact="1" data-correct="true">
                    <div class="fact-statement">
                        In Hergiswil ist jeder hundertste Einwohner ein Superreicher mit mindestens 50 Millionen Franken Verm√∂gen.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>

                <div class="fact-card" data-fact="2" data-correct="false">
                    <div class="fact-statement">
                        Alle Kantone verzeichnen einen Exodus von Superreichen aufgrund der Juso-Initiative ‚Äì auch der Kanton Zug verliert verm√∂gende Steuerzahler.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>

                <div class="fact-card" data-fact="3" data-correct="true">
                    <div class="fact-statement">
                        Im Kanton Zug zahlen 250 Superreiche 55% der Verm√∂genssteuern und 15% der Einkommenssteuern.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>

                <div class="fact-card" data-fact="4" data-correct="true">
                    <div class="fact-statement">
                        Nidwalden weist mit 22 Superreichen pro 10'000 Einwohner die h√∂chste Multimillion√§rs-Dichte aller Kantone auf.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>
            </div>

            <!-- === QUIZ (GESPERRT) === -->
            <div class="quiz-section locked" id="quiz-section">
                <div class="quiz-lock-overlay">
                    <h3>üîí Lernkontrollen gesperrt</h3>
                    <p>Bitte schlie√üen Sie erst alle drei interaktiven Aktivit√§ten ab, um die Lernkontrollen freizuschalten.</p>
                </div>

                <h2>üìù Lernkontrollen zum Artikel</h2>
                <div class="progress-text">Fortschritt: <span id="quiz-progress">0/6</span> Fragen beantwortet</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>

                <!-- Frage 1 -->
                <div class="question active" data-question="1">
                    <h3>Frage 1 von 6: Wie viele Superreiche mit √ºber 50 Millionen Franken Verm√∂gen leben in Hergiswil (6'300 Einwohner)?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">15 Personen</div>
                        <div class="option" data-answer="wrong">30 Personen</div>
                        <div class="option" data-answer="correct">59 Personen (jeder hundertste Einwohner)</div>
                        <div class="option" data-answer="wrong">100 Personen</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 2 -->
                <div class="question" data-question="2">
                    <h3>Frage 2 von 6: Welcher Kanton hat die h√∂chste Multimillion√§rs-Dichte (pro 10'000 Einwohner)?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Zug</div>
                        <div class="option" data-answer="wrong">Z√ºrich</div>
                        <div class="option" data-answer="correct">Nidwalden (22 Superreiche pro 10'000 Einwohner)</div>
                        <div class="option" data-answer="wrong">Schwyz</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 3 -->
                <div class="question" data-question="3">
                    <h3>Frage 3 von 6: Wie viel Prozent der schweizerischen Verm√∂genssteuern zahlen die rund 2800 Superreichen?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">10 Prozent</div>
                        <div class="option" data-answer="wrong">15 Prozent</div>
                        <div class="option" data-answer="correct">27 Prozent</div>
                        <div class="option" data-answer="wrong">50 Prozent</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 4 -->
                <div class="question" data-question="4">
                    <h3>Frage 4 von 6: Welcher Kanton verzeichnet √ºberraschenderweise weiterhin einen Zuwachs an Superreichen trotz der Juso-Initiative?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Nidwalden</div>
                        <div class="option" data-answer="wrong">Schwyz</div>
                        <div class="option" data-answer="correct">Zug</div>
                        <div class="option" data-answer="wrong">Z√ºrich</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 5 -->
                <div class="question" data-question="5">
                    <h3>Frage 5 von 6: Um wie viel hat sich die Zahl der Superreichen in der Schweiz zwischen 2005 und 2021 ver√§ndert?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Sie blieb etwa gleich</div>
                        <div class="option" data-answer="wrong">Sie verdoppelte sich</div>
                        <div class="option" data-answer="correct">Sie verdreifachte sich (von 760 auf 2500)</div>
                        <div class="option" data-answer="wrong">Sie stieg um 50%</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 6 -->
                <div class="question" data-question="6">
                    <h3>Frage 6 von 6: Mit welchen Steuerausf√§llen m√ºsste Z√ºrich laut Reto F√∂llmi bei Annahme der Initiative rechnen?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">100 Millionen Franken</div>
                        <div class="option" data-answer="wrong">200 Millionen Franken</div>
                        <div class="option" data-answer="correct">340 Millionen Franken (‚âà 10% der Einkommenssteuern)</div>
                        <div class="option" data-answer="wrong">500 Millionen Franken</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">Quiz abschlie√üen ‚úì</button>
                </div>
            </div>

            <div class="completion-message" id="completion-message">
                <h3>üéâ Herzlichen Gl√ºckwunsch!</h3>
                <p>Sie haben alle Lernkontrollen zur geografischen Verteilung der Superreichen bearbeitet.</p>
                <p style="margin-top: 15px;">Ihr Fortschritt wurde gespeichert.</p>
            </div>

            <div class="navigation">
                <a href="../index.html" class="nav-button secondary">‚Üê Zur√ºck zur √úbersicht</a>
                <a href="../umfrage.html" class="nav-button">Umfrage ‚Üí</a>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="../firebase-config.js"></script>

    <script>
// === FIREBASE TRACKING - KOMPATIBEL MIT DASHBOARD ===

let pageStartTime = Date.now();

// UserCode aus localStorage holen
function getUserCode() {
    return localStorage.getItem('userCode') || 'anonymous';
}

// === TRACKING FUNKTIONEN (Dashboard-kompatibel) ===

// Page Visit tracken
function trackPageVisit(pageName) {
    const userCode = getUserCode();
    const timestamp = Date.now();
    
    firebase.database().ref('users/' + userCode + '/visits/' + pageName).set({
        timestamp: timestamp,
        page: pageName
    }).then(() => {
        console.log('‚úì Page visit tracked:', pageName);
    }).catch(err => {
        console.error('‚úó Error tracking visit:', err);
    });
}

// Time Spent tracken
function trackTimeSpent(pageName) {
    const userCode = getUserCode();
    const timeSpent = Math.floor((Date.now() - pageStartTime) / 1000); // Sekunden
    
    firebase.database().ref('users/' + userCode + '/timeSpent/' + pageName).set({
        seconds: timeSpent,
        timestamp: Date.now()
    }).then(() => {
        console.log('‚úì Time spent tracked:', timeSpent, 'seconds');
    }).catch(err => {
        console.error('‚úó Error tracking time:', err);
    });
}

// Quiz Completion tracken
function trackQuizCompletion(pageName, correctAnswers, totalQuestions) {
    const userCode = getUserCode();
    
    firebase.database().ref('users/' + userCode + '/quizzes/' + pageName).set({
        correctAnswers: correctAnswers,
        totalQuestions: totalQuestions,
        timestamp: Date.now()
    }).then(() => {
        console.log('‚úì Quiz completion tracked:', correctAnswers, '/', totalQuestions);
    }).catch(err => {
        console.error('‚úó Error tracking quiz:', err);
    });
}

// Article Completion markieren
function markArticleComplete(pageName) {
    const userCode = getUserCode();
    
    firebase.database().ref('users/' + userCode + '/completions/' + pageName).set({
        completed: true,
        timestamp: Date.now()
    }).then(() => {
        console.log('‚úì Article marked as complete:', pageName);
    }).catch(err => {
        console.error('‚úó Error marking complete:', err);
    });
}

// === LOCALSTORAGE FUNKTIONEN ===

function getStorageKey(key) {
    const userCode = getUserCode();
    return `artikel4_${userCode}_${key}`;
}

function saveProgress() {
    // Slides
    localStorage.setItem(getStorageKey('currentSlide'), currentSlide);
    
    // Ranking
    localStorage.setItem(getStorageKey('placedCantons'), JSON.stringify(placedCantons));
    localStorage.setItem(getStorageKey('activitiesCompleted'), JSON.stringify(activitiesCompleted));
    
    // Matching
    localStorage.setItem(getStorageKey('answeredMatching'), JSON.stringify([...answeredMatching]));
    
    // Facts
    localStorage.setItem(getStorageKey('answeredFacts'), JSON.stringify([...answeredFacts]));
    
    // Quiz
    localStorage.setItem(getStorageKey('currentQuestion'), currentQuestion);
    localStorage.setItem(getStorageKey('answeredQuestions'), JSON.stringify([...answeredQuestions]));
    localStorage.setItem(getStorageKey('correctQuizAnswers'), correctQuizAnswers);
    
    // Section States
    localStorage.setItem(getStorageKey('rankingSectionUnlocked'), document.getElementById('ranking-section').classList.contains('unlocked'));
    localStorage.setItem(getStorageKey('matchingSectionUnlocked'), document.getElementById('matching-section').classList.contains('unlocked'));
    localStorage.setItem(getStorageKey('factsSectionUnlocked'), document.getElementById('facts-section').classList.contains('unlocked'));
    localStorage.setItem(getStorageKey('quizUnlocked'), !document.getElementById('quiz-section').classList.contains('locked'));
    
    console.log('‚úì Progress saved to localStorage');
}

function loadProgress() {
    const savedSlide = localStorage.getItem(getStorageKey('currentSlide'));
    const savedPlacedCantons = localStorage.getItem(getStorageKey('placedCantons'));
    const savedActivities = localStorage.getItem(getStorageKey('activitiesCompleted'));
    const savedMatching = localStorage.getItem(getStorageKey('answeredMatching'));
    const savedFacts = localStorage.getItem(getStorageKey('answeredFacts'));
    const savedCurrentQuestion = localStorage.getItem(getStorageKey('currentQuestion'));
    const savedAnsweredQuestions = localStorage.getItem(getStorageKey('answeredQuestions'));
    const savedCorrectAnswers = localStorage.getItem(getStorageKey('correctQuizAnswers'));
    
    let hasProgress = false;
    
    if (savedSlide) {
        currentSlide = parseInt(savedSlide);
        hasProgress = true;
    }
    
    if (savedPlacedCantons) {
        Object.assign(placedCantons, JSON.parse(savedPlacedCantons));
        hasProgress = true;
    }
    
    if (savedActivities) {
        Object.assign(activitiesCompleted, JSON.parse(savedActivities));
        hasProgress = true;
    }
    
    if (savedMatching) {
        answeredMatching = new Set(JSON.parse(savedMatching));
        hasProgress = true;
    }
    
    if (savedFacts) {
        answeredFacts = new Set(JSON.parse(savedFacts));
        hasProgress = true;
    }
    
    if (savedCurrentQuestion) {
        currentQuestion = parseInt(savedCurrentQuestion);
        hasProgress = true;
    }
    
    if (savedAnsweredQuestions) {
        answeredQuestions = new Set(JSON.parse(savedAnsweredQuestions));
        hasProgress = true;
    }
    
    if (savedCorrectAnswers) {
        correctQuizAnswers = parseInt(savedCorrectAnswers);
        hasProgress = true;
    }
    
    return hasProgress;
}

function restoreUIState() {
    // Restore Slides
    document.querySelectorAll('.slide').forEach((slide, index) => {
        slide.classList.toggle('active', index === currentSlide - 1);
    });
    updateSlideProgress();
    document.getElementById('prev-slide').disabled = (currentSlide === 1);
    document.getElementById('next-slide').disabled = (currentSlide === totalSlides);
    
    // Restore Section Unlocks
    if (localStorage.getItem(getStorageKey('rankingSectionUnlocked')) === 'true') {
        document.getElementById('ranking-section').classList.add('unlocked');
    }
    
    if (localStorage.getItem(getStorageKey('matchingSectionUnlocked')) === 'true') {
        document.getElementById('matching-section').classList.add('unlocked');
    }
    
    if (localStorage.getItem(getStorageKey('factsSectionUnlocked')) === 'true') {
        document.getElementById('facts-section').classList.add('unlocked');
    }
    
    if (localStorage.getItem(getStorageKey('quizUnlocked')) === 'true') {
        document.getElementById('quiz-section').classList.remove('locked');
    }
    
    // Restore Ranking
    if (Object.keys(placedCantons).length > 0) {
        Object.keys(placedCantons).forEach(canton => {
            const rank = placedCantons[canton];
            const chip = document.querySelector(`.canton-chip[data-canton="${canton}"]`);
            const dropZone = document.querySelector(`.drop-zone[data-rank="${rank}"]`);
            
            if (chip && dropZone) {
                chip.classList.add('placed');
                chip.draggable = false;
                
                const content = dropZone.querySelector('.drop-zone-content');
                const clone = chip.cloneNode(true);
                clone.draggable = false;
                clone.style.cursor = 'default';
                content.appendChild(clone);
            }
        });
        updateRankingProgress();
        
        if (Object.keys(placedCantons).length === 6 && !activitiesCompleted.ranking) {
            document.getElementById('check-ranking').disabled = false;
        }
    }
    
    // Restore Matching
    answeredMatching.forEach(questionNum => {
        const cards = document.querySelectorAll(`.matching-card[data-question="${questionNum}"]`);
        cards.forEach(card => {
            card.style.pointerEvents = 'none';
            if (card.dataset.answer === 'correct') {
                card.classList.add('correct');
            }
        });
        
        const feedback = document.getElementById(`matching-feedback-${questionNum}`);
        if (feedback) {
            feedback.className = 'activity-feedback correct show';
            feedback.textContent = '‚úì Richtig! ' + getMatchingFeedback(questionNum);
        }
    });
    updateMatchingProgress();
    
    // Restore Facts
    answeredFacts.forEach(factNum => {
        const card = document.querySelector(`.fact-card[data-fact="${factNum}"]`);
        if (card) {
            const isCorrect = card.dataset.correct === 'true';
            const buttons = card.querySelectorAll('.fact-btn');
            const feedback = card.querySelector('.fact-feedback');
            
            buttons.forEach(btn => {
                btn.disabled = true;
                const btnIsTrue = btn.dataset.answer === 'true';
                if (btnIsTrue === isCorrect) {
                    btn.classList.add('correct');
                }
            });
            
            feedback.className = 'fact-feedback correct show';
            feedback.textContent = '‚úì ' + getFactFeedback(factNum);
        }
    });
    updateFactsProgress();
    
    // Restore Quiz
    if (answeredQuestions.size > 0) {
        document.querySelectorAll('.question').forEach((q, index) => {
            const qNum = (index + 1).toString();
            q.classList.toggle('active', index === currentQuestion - 1);
            
            if (answeredQuestions.has(qNum)) {
                q.classList.add('answered');
                const options = q.querySelectorAll('.option');
                options.forEach(opt => {
                    if (opt.classList.contains('correct') || opt.classList.contains('incorrect')) {
                        // Already has state
                    } else if (opt.dataset.answer === 'correct') {
                        opt.classList.add('correct');
                    }
                });
                
                const nextButton = q.querySelector('.next-button');
                if (nextButton) {
                    nextButton.classList.add('show');
                }
                
                const feedback = q.querySelector('.feedback');
                if (feedback && !feedback.classList.contains('show')) {
                    feedback.className = 'feedback correct show';
                    feedback.textContent = '‚úì Beantwortet';
                }
            }
        });
        updateProgress();
    }
    
    console.log('‚úì UI state restored from localStorage');
}

// === SLIDES ===
let currentSlide = 1;
const totalSlides = 8;

function changeSlide(direction) {
    const slides = document.querySelectorAll('.slide');
    slides[currentSlide - 1].classList.remove('active');
    
    currentSlide += direction;
    
    if (currentSlide < 1) currentSlide = 1;
    if (currentSlide > totalSlides) currentSlide = totalSlides;
    
    slides[currentSlide - 1].classList.add('active');
    updateSlideProgress();
    
    // Buttons aktivieren/deaktivieren
    document.getElementById('prev-slide').disabled = (currentSlide === 1);
    document.getElementById('next-slide').disabled = (currentSlide === totalSlides);
    
    // Progress speichern
    saveProgress();
    
    // Nach letzter Slide Aktivit√§ten freischalten
    if (currentSlide === totalSlides) {
        setTimeout(() => {
            unlockRanking();
        }, 1000);
    }
}

function updateSlideProgress() {
    document.getElementById('slide-progress').textContent = `Seite ${currentSlide} von ${totalSlides}`;
}

function unlockRanking() {
    document.getElementById('ranking-section').classList.add('unlocked');
    document.getElementById('ranking-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
    saveProgress();
}

// === AKTIVIT√ÑTSSTATUS ===
let activitiesCompleted = {
    ranking: false,
    matching: false,
    facts: false
};

// === KANTONS-RANKING DRAG & DROP ===
let draggedElement = null;
const placedCantons = {};

document.querySelectorAll('.canton-chip').forEach(chip => {
    chip.addEventListener('dragstart', function(e) {
        draggedElement = this;
        this.classList.add('dragging');
    });

    chip.addEventListener('dragend', function() {
        this.classList.remove('dragging');
    });
});

document.querySelectorAll('.drop-zone').forEach(zone => {
    zone.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('drag-over');
    });

    zone.addEventListener('dragleave', function() {
        this.classList.remove('drag-over');
    });

    zone.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
        
        if (draggedElement) {
            const content = this.querySelector('.drop-zone-content');
            const clone = draggedElement.cloneNode(true);
            clone.draggable = false;
            clone.style.cursor = 'default';
            content.appendChild(clone);
            
            draggedElement.classList.add('placed');
            draggedElement.draggable = false;
            
            const canton = draggedElement.dataset.canton;
            const rank = this.dataset.rank;
            placedCantons[canton] = rank;
            
            updateRankingProgress();
            saveProgress();
            
            if (Object.keys(placedCantons).length === 6) {
                document.getElementById('check-ranking').disabled = false;
            }
        }
    });
});

function updateRankingProgress() {
    const count = Object.keys(placedCantons).length;
    document.getElementById('ranking-progress').textContent = `${count} von 6 Kantonen zugeordnet`;
}

function checkRanking() {
    let allCorrect = true;
    const dropZones = document.querySelectorAll('.drop-zone');
    
    dropZones.forEach(zone => {
        const rank = zone.dataset.rank;
        const content = zone.querySelector('.drop-zone-content');
        const chip = content.querySelector('.canton-chip');
        
        if (chip) {
            const correctRank = chip.dataset.rank;
            if (correctRank === rank) {
                zone.classList.add('correct');
            } else {
                zone.classList.add('incorrect');
                allCorrect = false;
            }
        }
    });

    const feedback = document.getElementById('ranking-feedback');
    if (allCorrect) {
        feedback.className = 'activity-feedback correct show';
        feedback.textContent = '‚úì Perfekt! Alle Kantone wurden korrekt zugeordnet. Nidwalden weist dank Hergiswil mit Abstand die h√∂chste Superreichen-Dichte auf.';
        activitiesCompleted.ranking = true;
        saveProgress();
        setTimeout(() => {
            unlockMatching();
        }, 1500);
    } else {
        feedback.className = 'activity-feedback incorrect show';
        feedback.textContent = '‚úó Nicht ganz. Einige Zuordnungen sind noch nicht korrekt. Versuchen Sie es erneut!';
        
        setTimeout(() => {
            resetRanking();
        }, 3000);
    }
}

function resetRanking() {
    document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.classList.remove('correct', 'incorrect');
        zone.querySelector('.drop-zone-content').innerHTML = '';
    });
    
    document.querySelectorAll('.canton-chip').forEach(chip => {
        chip.classList.remove('placed');
        chip.draggable = true;
        chip.style.cursor = 'move';
    });
    
    Object.keys(placedCantons).forEach(key => delete placedCantons[key]);
    updateRankingProgress();
    document.getElementById('check-ranking').disabled = true;
    document.getElementById('ranking-feedback').classList.remove('show');
    saveProgress();
}

function unlockMatching() {
    document.getElementById('matching-section').classList.add('unlocked');
    document.getElementById('matching-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
    saveProgress();
}

// === ZAHLEN-MATCHING ===
let answeredMatching = new Set();
const totalMatching = 4;

document.querySelectorAll('.matching-card').forEach(card => {
    card.addEventListener('click', function() {
        const questionNum = this.dataset.question;
        if (answeredMatching.has(questionNum)) return;
        
        const isCorrect = this.dataset.answer === 'correct';
        const feedback = document.getElementById(`matching-feedback-${questionNum}`);
        const allCards = document.querySelectorAll(`[data-question="${questionNum}"]`);
        
        allCards.forEach(c => c.style.pointerEvents = 'none');
        this.classList.add('selected');
        
        setTimeout(() => {
            if (isCorrect) {
                this.classList.remove('selected');
                this.classList.add('correct');
                feedback.className = 'activity-feedback correct show';
                feedback.textContent = '‚úì Richtig! ' + getMatchingFeedback(questionNum);
            } else {
                this.classList.remove('selected');
                this.classList.add('incorrect');
                allCards.forEach(c => {
                    if (c.dataset.answer === 'correct') {
                        c.classList.add('correct');
                    }
                });
                feedback.className = 'activity-feedback incorrect show';
                feedback.textContent = '‚úó Nicht ganz. ' + getMatchingFeedback(questionNum);
            }
            
            answeredMatching.add(questionNum);
            updateMatchingProgress();
            saveProgress();
            
            if (answeredMatching.size === totalMatching && !activitiesCompleted.matching) {
                activitiesCompleted.matching = true;
                saveProgress();
                setTimeout(() => {
                    unlockFacts();
                }, 1500);
            }
        }, 500);
    });
});

function updateMatchingProgress() {
    document.getElementById('matching-progress').textContent = `${answeredMatching.size} von ${totalMatching} Fragen beantwortet`;
}

function getMatchingFeedback(questionNum) {
    const feedbacks = {
        '1': '59 Superreiche in einem Dorf von 6\'300 Einwohnern ‚Äì das ist jeder hundertste!',
        '2': 'Die 2800 Superreichen zahlen 27% der Verm√∂genssteuern und zus√§tzlich 3,1% der Einkommenssteuern.',
        '3': 'Z√ºrich w√ºrde 340 Millionen Franken Steuerausf√§lle erleiden, etwa 10% der Einkommenssteuern.',
        '4': 'Von 760 (2005) auf 2500 (2021) ‚Äì eine Verdreifachung der Superreichen in nur 16 Jahren.'
    };
    return feedbacks[questionNum] || '';
}

function unlockFacts() {
    document.getElementById('facts-section').classList.add('unlocked');
    document.getElementById('facts-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    const badge = document.createElement('div');
    badge.className = 'unlock-badge';
    badge.textContent = 'üîì Faktencheck freigeschaltet!';
    badge.style.marginTop = '20px';
    document.getElementById('matching-section').appendChild(badge);
    saveProgress();
}

// === FAKTENCHECK ===
let answeredFacts = new Set();
const totalFacts = 4;

document.querySelectorAll('.fact-card').forEach(card => {
    const buttons = card.querySelectorAll('.fact-btn');
    const factNum = card.dataset.fact;
    const isCorrect = card.dataset.correct === 'true';

    buttons.forEach(button => {
        button.addEventListener('click', function() {
            if (answeredFacts.has(factNum)) return;

            const userAnswer = this.dataset.answer === 'true';
            const feedback = card.querySelector('.fact-feedback');
            const answerCorrect = userAnswer === isCorrect;

            buttons.forEach(btn => btn.disabled = true);
            
            if (answerCorrect) {
                this.classList.add('correct');
                feedback.className = 'fact-feedback correct show';
                feedback.textContent = '‚úì Richtig! ' + getFactFeedback(factNum);
            } else {
                this.classList.add('incorrect');
                buttons.forEach(btn => {
                    if ((btn.dataset.answer === 'true') === isCorrect) {
                        btn.classList.add('correct');
                    }
                });
                feedback.className = 'fact-feedback incorrect show';
                feedback.textContent = '‚úó Falsch. ' + getFactFeedback(factNum);
            }

            answeredFacts.add(factNum);
            updateFactsProgress();
            saveProgress();

            if (answeredFacts.size === totalFacts && !activitiesCompleted.facts) {
                activitiesCompleted.facts = true;
                saveProgress();
                setTimeout(() => {
                    unlockQuiz();
                }, 1500);
            }
        });
    });
});

function updateFactsProgress() {
    document.getElementById('facts-progress').textContent = `${answeredFacts.size} von ${totalFacts} Aussagen beantwortet`;
}

function getFactFeedback(factNum) {
    const feedbacks = {
        '1': 'Stimmt genau ‚Äì 59 von 6\'300 Einwohnern entspricht etwa jedem hundertsten!',
        '2': 'Falsch! Nur Zug verzeichnet weiterhin Zuwachs. Heinz T√§nnler kann sich selbst nicht erkl√§ren warum.',
        '3': 'Richtig! Diese 250 Personen sind f√ºr mehr als die H√§lfte der Verm√∂genssteuern verantwortlich.',
        '4': 'Korrekt! Mit 22 Superreichen pro 10\'000 Einwohner liegt Nidwalden deutlich vor Schwyz und Zug (je 18).'
    };
    return feedbacks[factNum] || '';
}

function unlockQuiz() {
    const quizSection = document.getElementById('quiz-section');
    quizSection.classList.remove('locked');
    quizSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    const badge = document.createElement('div');
    badge.className = 'unlock-badge';
    badge.textContent = 'üîì Lernkontrollen freigeschaltet!';
    badge.style.marginTop = '20px';
    document.getElementById('facts-section').appendChild(badge);
    saveProgress();
}

// === QUIZ ===
let currentQuestion = 1;
let answeredQuestions = new Set();
let correctQuizAnswers = 0;
const totalQuestions = 6;

document.querySelectorAll('.option').forEach(option => {
    option.addEventListener('click', function() {
        const question = this.closest('.question');
        const questionNum = question.dataset.question;
        const options = question.querySelectorAll('.option');
        const feedback = question.querySelector('.feedback');
        const nextButton = question.querySelector('.next-button');
        
        if (answeredQuestions.has(questionNum)) return;
        
        options.forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        
        const isCorrect = this.dataset.answer === 'correct';
        
        setTimeout(() => {
            if (isCorrect) {
                this.classList.add('correct');
                feedback.className = 'feedback correct show';
                feedback.textContent = '‚úì Richtig! ' + getQuizFeedback(questionNum);
                correctQuizAnswers++;
            } else {
                this.classList.add('incorrect');
                options.forEach(opt => {
                    if (opt.dataset.answer === 'correct') {
                        opt.classList.add('correct');
                    }
                });
                feedback.className = 'feedback incorrect show';
                feedback.textContent = '‚úó Nicht ganz. ' + getQuizFeedback(questionNum);
            }
            
            question.classList.add('answered');
            answeredQuestions.add(questionNum);
            nextButton.classList.add('show');
            updateProgress();
            saveProgress();
        }, 300);
    });
});

function showNextQuestion() {
    const currentQ = document.querySelector(`.question[data-question="${currentQuestion}"]`);
    currentQ.classList.remove('active');
    
    currentQuestion++;
    
    if (currentQuestion <= totalQuestions) {
        const nextQ = document.querySelector(`.question[data-question="${currentQuestion}"]`);
        nextQ.classList.add('active');
        saveProgress();
    } else {
        // Quiz abgeschlossen
        document.getElementById('completion-message').classList.add('show');
        
        // Tracking: Quiz Completion
        trackQuizCompletion('artikel4', correctQuizAnswers, totalQuestions);
        
        // Tracking: Article Completion
        markArticleComplete('artikel4');
        
        // Tracking: Time Spent
        trackTimeSpent('artikel4');
        
        saveProgress();
        
        console.log('üìä Final Stats:');
        console.log('  - Correct Quiz Answers:', correctQuizAnswers, '/', totalQuestions);
    }
}

function updateProgress() {
    const progress = (answeredQuestions.size / totalQuestions) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('quiz-progress').textContent = `${answeredQuestions.size}/${totalQuestions}`;
}

function getQuizFeedback(questionNum) {
    const feedbacks = {
        '1': 'Das bedeutet: Jeder hundertste Hergiswiler ist ein Superreicher ‚Äì eine extreme Konzentration!',
        '2': 'Dank Hergiswil weist Nidwalden mit 22 Superreichen pro 10\'000 Einwohner die mit Abstand h√∂chste Dichte auf.',
        '3': 'Dazu kommen noch 3,1% der Einkommenssteuern. Bei einem Totalausfall h√§tte das sp√ºrbare Folgen f√ºr alle.',
        '4': 'Finanzdirektor Heinz T√§nnler kann sich selber nicht erkl√§ren, warum das Interesse von reichen Ausl√§ndern ¬´ungebrochen hoch¬ª ist.',
        '5': 'Diese Verdreifachung zeigt, wie stark die Schweiz in den letzten Jahren von Superreichen abh√§ngig geworden ist.',
        '6': 'Das entspricht ungef√§hr 10 Prozent der Einkommenssteuern von nat√ºrlichen Personen im Kanton Z√ºrich.'
    };
    return feedbacks[questionNum] || '';
}

// === INITIALISIERUNG ===

window.addEventListener('load', () => {
    const userCode = getUserCode();
    console.log('=== ARTIKEL 4 GELADEN ===');
    console.log('User:', userCode);
    console.log('Tracking zu: users/' + userCode + '/');
    
    document.getElementById('check-ranking').disabled = true;
    trackPageVisit('artikel4');
    
    const hasProgress = loadProgress();
    if (hasProgress) {
        console.log('üîÑ Restoring previous progress...');
        restoreUIState();
    } else {
        console.log('üÜï Starting fresh');
    }
});

// Beim Verlassen: Time Spent tracken
window.addEventListener('beforeunload', () => {
    trackTimeSpent('artikel4');
});

// Auto-Save alle 30 Sekunden
setInterval(() => {
    saveProgress();
}, 30000);
    </script>
</body>
</html>
