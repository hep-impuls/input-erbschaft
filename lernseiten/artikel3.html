<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artikel: Schweiz im internationalen Vergleich - hep Verlag</title>
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #003876 0%, #5eb9b4 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #003876;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .article-link {
            background: #f8f9fa;
            border-left: 4px solid #5eb9b4;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .article-link h2 {
            color: #003876;
            margin-bottom: 10px;
        }

        /* Interaktive Sektionen */
        .interactive-section {
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .interactive-section h2 {
            color: #003876;
            margin-bottom: 20px;
            text-align: center;
        }

        .activity-progress {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            color: #003876;
        }

        /* === TIMELINE-AKTIVIT√ÑT === */
        .timeline-game {
            margin-top: 25px;
        }

        .countries-pool {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            min-height: 100px; /* Sicherstellen, dass der Pool sichtbar ist */
        }

        .country-chip {
            background: linear-gradient(135deg, #003876, #5eb9b4);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            text-align: center;
            cursor: grab; /* Ge√§ndert auf grab */
            font-weight: 600;
            transition: all 0.3s;
            user-select: none;
        }
        
        /* Neuer Stil f√ºr platzierte Chips in den Drop-Zonen */
        .drop-zone .country-chip {
            cursor: move; /* Move in der Zone */
            opacity: 1 !important; /* Volle Sichtbarkeit in der Dropzone */
        }

        .country-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .country-chip.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .country-chip.placed {
            background: #4caf50;
            cursor: default;
        }
        
        /* Chips, die im Pool versteckt sind, aber platziert wurden */
        .countries-pool .country-chip.placed {
            display: none; 
        }

        .timeline-drops {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .drop-zone {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: white;
            border: 3px dashed #e0e0e0;
            border-radius: 10px;
            min-height: 80px;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            border-color: #5eb9b4;
            background: #e8f4f8;
        }

        .drop-zone.correct {
            border-color: #4caf50;
            background: #e8f5e9;
            border-style: solid;
        }

        .drop-zone.incorrect {
            border-color: #f44336;
            background: #ffebee;
            border-style: solid;
        }

        .drop-zone-year {
            font-size: 1.5em;
            font-weight: bold;
            color: #003876;
            min-width: 80px;
        }

        .drop-zone-content {
            flex: 1;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .timeline-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .timeline-feedback.show {
            display: block;
        }

        .timeline-feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .timeline-feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .check-btn {
            background: #5eb9b4;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s;
            opacity: 1;
        }

        .check-btn:hover:not(:disabled) {
            background: #4a9a95;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(94, 185, 180, 0.4);
        }

        .check-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: #ccc;
        }

        /* === L√ÑNDERVERGLEICH === */
        .comparison-section {
            display: none;
        }

        .comparison-section.unlocked {
            display: block;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .country-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .country-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .country-card.selected {
            border-color: #5eb9b4;
            background: #e8f4f8;
        }

        .country-flag {
            font-size: 3em;
            text-align: center;
            margin-bottom: 10px;
        }

        .country-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #003876;
            text-align: center;
            margin-bottom: 15px;
        }

        .country-facts {
            font-size: 0.9em;
            line-height: 1.6;
        }

        .country-facts div {
            margin-bottom: 8px;
        }

        .comparison-question {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 600;
            color: #856404;
        }

        .comparison-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .comparison-feedback.show {
            display: block;
        }

        .comparison-feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .comparison-feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        /* === FAKTENCHECK === */
        .facts-section {
            display: none;
        }

        .facts-section.unlocked {
            display: block;
        }

        .fact-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .fact-statement {
            font-size: 1.15em;
            margin-bottom: 20px;
            color: #003876;
            font-weight: 600;
            line-height: 1.6;
        }

        .fact-buttons {
            display: flex;
            gap: 15px;
        }

        .fact-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .fact-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .fact-btn:disabled {
            cursor: not-allowed;
        }

        .fact-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .fact-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .fact-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .fact-feedback.show {
            display: block;
        }

        .fact-feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .fact-feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        /* === QUIZ (GESPERRT) === */
        .quiz-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 3px solid #5eb9b4;
            position: relative;
        }

        .quiz-section.locked {
            opacity: 0.5;
            pointer-events: none;
        }

        .quiz-lock-overlay {
            position: absolute;
            top: 0; /* Changed from 50% to 0 to cover the whole section height */
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 56, 118, 0.95);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px 40px;
            border-radius: 10px;
            text-align: center;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        /* Adjusted overlay display for better visibility */
        .quiz-section.locked .quiz-lock-overlay {
             display: flex; /* Always display for proper coverage */
             opacity: 1; /* Show when locked */
        }

        .quiz-lock-overlay h3 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .quiz-section h2 {
            color: #003876;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .question {
            background: #f8f9fa;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .question.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question.answered {
            border-color: #5eb9b4;
        }

        .question h3 {
            color: #003876;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            background: white;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #5eb9b4;
            transform: translateX(5px);
        }

        .option.selected {
            background: #5eb9b4;
            color: white;
            border-color: #5eb9b4;
        }

        .option.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .option.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .next-button {
            background: #003876;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 1em;
            transition: background 0.3s;
            display: none;
        }

        .next-button.show {
            display: inline-block;
        }

        .next-button:hover {
            background: #002855;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #003876, #5eb9b4);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            color: #003876;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .unlock-badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .nav-button {
            background: #5eb9b4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }

        .nav-button:hover {
            background: #4a9a95;
        }

        .nav-button.secondary {
            background: #003876;
        }

        .nav-button.secondary:hover {
            background: #002855;
        }

        .completion-message {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 30px;
            display: none;
        }

        .completion-message.show {
            display: block;
        }

        .completion-message h3 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .countries-pool, .comparison-grid {
                grid-template-columns: 1fr;
            }

            .fact-buttons {
                flex-direction: column;
            }

            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .drop-zone {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }

            .drop-zone-year {
                min-width: unset;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Artikel: Internationaler Vergleich</h1>
            <p>Mit Erbschaftssteuern f√ºr Superreiche w√ºrde die Schweiz zum Super-Sonderfall</p>
        </div>

        <div class="content">
            <div class="article-link">
                <h2>üìÑ Originalartikel</h2>
                <p><strong>Autor:</strong> Simon Schmid</p>
                <p><strong>Thema:</strong> Juso-Initiative im L√§ndervergleich ‚Äì Historische Entwicklung der Erbschaftssteuern weltweit</p>
                <a href="https://www.tagesanzeiger.ch/erbschaftssteuer-schweiz-juso-initiative-als-globaler-sonderfall-142294996360" style="display: inline-block; background: #5eb9b4; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; margin-top: 10px;" target="_blank">Artikel im Original lesen (freiwillig) ‚Üí</a>
            </div>

            <!-- === SCHRITT 1: TIMELINE-SPIEL === -->
            <div class="interactive-section" id="timeline-section-main">
                <h2>üìÖ Schritt 1: Zeitstrahl der Abschaffungen</h2>
                <p style="text-align: center; margin-bottom: 20px;">Ordnen Sie die L√§nder dem Jahr zu, in dem sie die Erbschaftssteuer abschafften. Ziehen Sie die L√§ndernamen auf die passenden Jahreszahlen.</p>
                <div class="activity-progress" id="timeline-progress">0 von 6 L√§ndern zugeordnet</div>
                
                <div class="timeline-game">
                    <div class="countries-pool" id="countries-pool">
                        <div class="country-chip" draggable="true" data-country="kanada" data-year="1971">üá®üá¶ Kanada</div>
                        <div class="country-chip" draggable="true" data-country="australien" data-year="1979">üá¶üá∫ Australien</div>
                        <div class="country-chip" draggable="true" data-country="neuseeland" data-year="2001">üá≥üáø Neuseeland</div>
                        <div class="country-chip" draggable="true" data-country="schweden" data-year="2004">üá∏üá™ Schweden</div>
                        <div class="country-chip" draggable="true" data-country="oesterreich" data-year="2008">üá¶üáπ √ñsterreich</div>
                        <div class="country-chip" draggable="true" data-country="norwegen" data-year="2013">üá≥üá¥ Norwegen</div>
                    </div>

                    <div class="timeline-drops" id="timeline-drops-container">
                        <div class="drop-zone" data-year="1971">
                            <div class="drop-zone-year">1971</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-year="1979">
                            <div class="drop-zone-year">1979</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-year="2001">
                            <div class="drop-zone-year">2001</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-year="2004">
                            <div class="drop-zone-year">2004</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-year="2008">
                            <div class="drop-zone-year">2008</div>
                            <div class="drop-zone-content"></div>
                        </div>
                        <div class="drop-zone" data-year="2013">
                            <div class="drop-zone-year">2013</div>
                            <div class="drop-zone-content"></div>
                        </div>
                    </div>

                    <button class="check-btn" id="check-timeline" onclick="checkTimeline()">√úberpr√ºfen</button>
                    <div class="timeline-feedback" id="timeline-feedback"></div>
                </div>
            </div>

            <!-- === SCHRITT 2: L√ÑNDERVERGLEICH === -->
            <div class="interactive-section comparison-section" id="comparison-section">
                <h2>üåê Schritt 2: L√§nderspezifika verstehen</h2>
                <p style="text-align: center; margin-bottom: 20px;">W√§hlen Sie das Land aus, auf das die folgende Aussage zutrifft.</p>
                <div class="activity-progress" id="comparison-progress">0 von 3 Fragen beantwortet</div>

                <!-- Frage 1 -->
                <div class="comparison-question" data-question="1" data-correct="schweden">
                    Welches Land schaffte die Erbschaftssteuer unter einer sozialdemokratischen Regierung ab, weil Ausnahmen dazu f√ºhrten, dass die Mittelklasse die Hauptlast trug?
                </div>
                <div class="comparison-grid" data-question-ref="1">
                    <div class="country-card" data-answer="schweden">
                        <div class="country-flag">üá∏üá™</div>
                        <div class="country-name">Schweden</div>
                        <div class="country-facts">
                            <div><strong>Abschaffung:</strong> 2004</div>
                            <div><strong>Regierung:</strong> Sozialdemokratisch</div>
                            <div><strong>Grund:</strong> Ungerechte Lastverteilung</div>
                        </div>
                    </div>
                    <div class="country-card" data-answer="norwegen">
                        <div class="country-flag">üá≥üá¥</div>
                        <div class="country-name">Norwegen</div>
                        <div class="country-facts">
                            <div><strong>Abschaffung:</strong> 2013</div>
                            <div><strong>Besonderheit:</strong> Trotz hohem Wohlfahrtsstaat</div>
                            <div><strong>Grund:</strong> Kapitalmobilit√§t</div>
                        </div>
                    </div>
                    <div class="country-card" data-answer="oesterreich">
                        <div class="country-flag">üá¶üáπ</div>
                        <div class="country-name">√ñsterreich</div>
                        <div class="country-facts">
                            <div><strong>Abschaffung:</strong> 2008</div>
                            <div><strong>Besonderheit:</strong> Erste Einf√ºhrung 1759</div>
                            <div><strong>Grund:</strong> Praktische Probleme</div>
                        </div>
                    </div>
                </div>
                <div class="comparison-feedback" id="comparison-feedback-1"></div>

                <!-- Frage 2 -->
                <div class="comparison-question" data-question="2" data-correct="oesterreich" style="margin-top: 40px;">
                    Welches Land f√ºhrte als eines der ersten 1759 eine Erbschaftssteuer zur Kriegsfinanzierung ein (Siebenj√§hriger Krieg)?
                </div>
                <div class="comparison-grid" data-question-ref="2">
                    <div class="country-card" data-answer="schweiz">
                        <div class="country-flag">üá®üá≠</div>
                        <div class="country-name">Schweiz</div>
                        <div class="country-facts">
                            <div><strong>Besonderheit:</strong> F√∂deralismus</div>
                            <div><strong>Heute:</strong> Doppelbesteuerung (Verm√∂gen + Erbe)</div>
                            <div><strong>Status:</strong> ¬´Super-Sonderfall¬ª</div>
                        </div>
                    </div>
                    <div class="country-card" data-answer="oesterreich">
                        <div class="country-flag">üá¶üáπ</div>
                        <div class="country-name">√ñsterreich</div>
                        <div class="country-facts">
                            <div><strong>Erste Einf√ºhrung:</strong> 1759</div>
                            <div><strong>Anlass:</strong> Siebenj√§hriger Krieg</div>
                            <div><strong>Abschaffung:</strong> 2008</div>
                        </div>
                    </div>
                    <div class="country-card" data-answer="grossbritannien">
                        <div class="country-flag">üá¨üáß</div>
                        <div class="country-name">Grossbritannien</div>
                        <div class="country-facts">
                            <div><strong>Einf√ºhrung:</strong> 1796</div>
                            <div><strong>Anlass:</strong> Krieg gegen Napoleon</div>
                            <div><strong>Status:</strong> Noch aktiv</div>
                        </div>
                    </div>
                </div>
                <div class="comparison-feedback" id="comparison-feedback-2"></div>

                <!-- Frage 3 -->
                <div class="comparison-question" data-question="3" data-correct="schweiz" style="margin-top: 40px;">
                    Welches Land hat heute noch sowohl eine Verm√∂genssteuer ALS AUCH eine Erbschaftssteuer - fast weltweit einzigartig?
                </div>
                <div class="comparison-grid" data-question-ref="3">
                    <div class="country-card" data-answer="usa">
                        <div class="country-flag">üá∫üá∏</div>
                        <div class="country-name">USA</div>
                        <div class="country-facts">
                            <div><strong>Freibetrag:</strong> 15 Mio. Dollar (geplant)</div>
                            <div><strong>Problem:</strong> Viele Schlupfl√∂cher</div>
                            <div><strong>Status:</strong> Hohe Steuers√§tze, wenig Einnahmen</div>
                        </div>
                    </div>
                    <div class="country-card" data-answer="deutschland">
                        <div class="country-flag">üá©üá™</div>
                        <div class="country-name">Deutschland</div>
                        <div class="country-facts">
                            <div><strong>Status:</strong> Hat Erbschaftssteuer</div>
                            <div><strong>Debatte:</strong> √úber h√∂here Steuern</div>
                            <div><strong>Besonderheit:</strong> Keine Verm√∂genssteuer</div>
                        </div>
                    </div>
                    <div class="country-card" data-answer="schweiz">
                        <div class="country-flag">üá®üá≠</div>
                        <div class="country-name">Schweiz</div>
                        <div class="country-facts">
                            <div><strong>Besonderheit:</strong> Beide Steuern!</div>
                            <div><strong>Problem:</strong> Doppelbesteuerung</div>
                            <div><strong>Status:</strong> Fast weltweit einzigartig</div>
                        </div>
                    </div>
                </div>
                <div class="comparison-feedback" id="comparison-feedback-3"></div>
            </div>

            <!-- === SCHRITT 3: FAKTENCHECK === -->
            <div class="interactive-section facts-section" id="facts-section">
                <h2>‚úÖ Schritt 3: Historische Fakten √ºberpr√ºfen</h2>
                <p style="text-align: center; margin-bottom: 20px;">Richtig oder falsch? Entscheiden Sie bei den folgenden Aussagen.</p>
                <div class="activity-progress" id="facts-progress">0 von 4 Aussagen beantwortet</div>

                <div class="fact-card" data-fact="1" data-correct="true">
                    <div class="fact-statement">
                        Historisch wurden Erbschaftssteuern h√§ufig zur Kriegsfinanzierung eingef√ºhrt, etwa in √ñsterreich 1759 oder Grossbritannien 1796.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>

                <div class="fact-card" data-fact="2" data-correct="false">
                    <div class="fact-statement">
                        Die Schweiz ist das einzige Land weltweit, das heute noch eine Erbschaftssteuer kennt.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>

                <div class="fact-card" data-fact="3" data-correct="true">
                    <div class="fact-statement">
                        Weniger als 0,5% der gesamten Steuereinnahmen in OECD-L√§ndern stammen heute aus Erbschaftssteuern.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>

                <div class="fact-card" data-fact="4" data-correct="true">
                    <div class="fact-statement">
                        Die Kombination von 50% Steuersatz und 50 Millionen Franken Freibetrag in der Juso-Initiative ist weltweit einzigartig.
                    </div>
                    <div class="fact-buttons">
                        <button class="fact-btn" data-answer="true">‚úì Richtig</button>
                        <button class="fact-btn" data-answer="false">‚úó Falsch</button>
                    </div>
                    <div class="fact-feedback"></div>
                </div>
            </div>

            <!-- === QUIZ (GESPERRT) === -->
            <div class="quiz-section locked" id="quiz-section">
                <div class="quiz-lock-overlay">
                    <h3>üîí Quiz gesperrt</h3>
                    <p>Bitte schlie√üen Sie erst alle drei interaktiven Aktivit√§ten ab, um das Quiz freizuschalten.</p>
                </div>

                <h2>üìù Kontrollfragen zum Artikel</h2>
                <div class="progress-text">Fortschritt: <span id="quiz-progress">0/6</span> Fragen beantwortet</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>

                <!-- Frage 1 -->
                <div class="question active" data-question="1">
                    <h3>Frage 1 von 6: Wof√ºr wurden Erbschaftssteuern historisch oft eingef√ºhrt?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Zur Finanzierung von Infrastrukturprojekten</div>
                        <div class="option" data-answer="correct">Zur Kriegsfinanzierung</div>
                        <div class="option" data-answer="wrong">Zur Umverteilung von Verm√∂gen</div>
                        <div class="option" data-answer="wrong">Zur Finanzierung des Bildungssystems</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 2 -->
                <div class="question" data-question="2">
                    <h3>Frage 2 von 6: Was macht die Schweiz im internationalen Vergleich besonders?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Sie hat die h√∂chsten Erbschaftssteuern weltweit</div>
                        <div class="option" data-answer="correct">Sie hat sowohl Verm√∂genssteuer als auch Erbschaftssteuer ‚Äì fast einzigartig</div>
                        <div class="option" data-answer="wrong">Sie hat die Erbschaftssteuer 2013 abgeschafft</div>
                        <div class="option" data-answer="wrong">Sie besteuert nur Nicht-Verwandte, nicht aber direkte Nachkommen</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 3 -->
                <div class="question" data-question="3">
                    <h3>Frage 3 von 6: Welches Land schaffte 2004 die Erbschaftssteuer ab, obwohl eine sozialdemokratische Regierung an der Macht war?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Norwegen</div>
                        <div class="option" data-answer="correct">Schweden</div>
                        <div class="option" data-answer="wrong">√ñsterreich</div>
                        <div class="option" data-answer="wrong">Australien</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 4 -->
                <div class="question" data-question="4">
                    <h3>Frage 4 von 6: Wie viel Prozent der gesamten Steuereinnahmen in OECD-L√§ndern stammen heute aus Erbschaftssteuern?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Etwa 5 Prozent</div>
                        <div class="option" data-answer="wrong">Etwa 2 Prozent</div>
                        <div class="option" data-answer="correct">Weniger als 0,5 Prozent</div>
                        <div class="option" data-answer="wrong">Etwa 10 Prozent</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 5 -->
                <div class="question" data-question="5">
                    <h3>Frage 5 von 6: Warum bezeichnet Laura Seelkopf die Juso-Initiative als ¬´sehr ungew√∂hnlich¬ª?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Weil sie zu niedrige Steuers√§tze vorsieht</div>
                        <div class="option" data-answer="correct">Weil die Kombination von 50% Steuersatz und 50 Mio. Freibetrag weltweit einzigartig ist</div>
                        <div class="option" data-answer="wrong">Weil sie auch kleine Erbschaften besteuert</div>
                        <div class="option" data-answer="wrong">Weil sie nur f√ºr ausl√§ndische Erben gilt</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">N√§chste Frage ‚Üí</button>
                </div>

                <!-- Frage 6 -->
                <div class="question" data-question="6">
                    <h3>Frage 6 von 6: Welcher Grund wird im Artikel NICHT als Erkl√§rung f√ºr den R√ºckgang der Erbschaftssteuern genannt?</h3>
                    <div class="options">
                        <div class="option" data-answer="wrong">Fehlende Dringlichkeit in Friedenszeiten</div>
                        <div class="option" data-answer="wrong">Praktische Probleme f√ºr Erben von Familienbetrieben</div>
                        <div class="option" data-answer="correct">Steigende Lebenserwartung der Bev√∂lkerung</div>
                        <div class="option" data-answer="wrong">Zunehmende Kapitalmobilit√§t durch Globalisierung</div>
                    </div>
                    <div class="feedback"></div>
                    <button class="next-button" onclick="showNextQuestion()">Quiz abschlie√üen ‚úì</button>
                </div>
            </div>

            <div class="completion-message" id="completion-message">
                <h3>üéâ Herzlichen Gl√ºckwunsch!</h3>
                <p>Sie haben alle Kontrollfragen zum internationalen Vergleich bearbeitet.</p>
                <p style="margin-top: 15px;">Ihr Fortschritt wurde gespeichert.</p>
            </div>

            <div class="navigation">
                <!-- Die Links werden auf Ihrer Seite wahrscheinlich relativ zu anderen Seiten liegen -->
                <a href="../index.html" class="nav-button secondary">‚Üê Zur√ºck zur √úbersicht</a>
                <a href="artikel4.html" class="nav-button">N√§chster Artikel ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs f√ºr Firestore und Auth -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, getDoc, updateDoc, serverTimestamp, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        const PAGE_NAME = 'artikel3';
        let db, auth, userId, appId;
        let pageStartTime = Date.now();
        let firebaseReady = false;

        // 1. Initialisierung und Authentifizierung (MANDATORY)
        try {
            const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
            appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            if (Object.keys(firebaseConfig).length === 0) {
                console.error("‚ùå Firebase Config ist leer. Speicherung funktioniert nicht.");
                // Fallback, aber Speichern wird fehlschlagen
                userId = 'anonymous-' + crypto.randomUUID();
            } else {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                const authPromise = typeof __initial_auth_token !== 'undefined' && __initial_auth_token
                    ? signInWithCustomToken(auth, __initial_auth_token)
                    : signInAnonymously(auth);

                authPromise.then(userCredential => {
                    userId = userCredential.user.uid;
                    firebaseReady = true;
                    console.log(`‚úÖ Firebase Ready. User ID: ${userId}, App ID: ${appId}`);
                    // 1. Track page visit
                    trackPageVisit(PAGE_NAME);
                    // 2. Load and apply progress
                    loadProgressAndInitializeUI(); // Hinzugef√ºgt: Laden des Fortschritts nach Auth
                }).catch(err => {
                    console.error("‚ùå Firebase Auth Error:", err);
                    userId = 'anonymous-' + crypto.randomUUID(); // Fallback
                    firebaseReady = true;
                });
            }

        } catch (error) {
            console.error("‚ùå FATAL: Firebase Initialization Error:", error);
            userId = 'anonymous-' + crypto.randomUUID();
            firebaseReady = true;
        }


        // === FIREBASE TRACKING - AUF FIRESTORE UMGESTELLT ===

        // Basis-Pfad f√ºr Benutzerdaten
        function getUserDocRef(pageName) {
            if (!firebaseReady) {
                console.warn("‚ö†Ô∏è Firebase ist noch nicht bereit.");
                return null;
            }
            // Pfad: /artifacts/{appId}/users/{userId}/tracking_data/{pageName}
            return doc(db, 'artifacts', appId, 'users', userId, 'tracking_data', pageName);
        }

        /**
         * Trackt den Seitenbesuch.
         * @param {string} pageName - Der Name der aktuellen Seite/Aktivit√§t.
         */
        export async function trackPageVisit(pageName) {
            const docRef = getUserDocRef(pageName);
            if (!docRef) return;

            try {
                // Liest den aktuellen Status oder erstellt ihn neu
                const docSnap = await getDoc(docRef);
                const data = docSnap.exists() ? docSnap.data() : { 
                    firstVisit: serverTimestamp(),
                    pageName: pageName,
                    timeSpent: 0,
                    activitiesProgress: {}, // NEU: Initialisierung des Fortschritts-Objekts
                    quizScore: 0,
                    quizTotal: 0
                };

                // Setzt den letzten Besuch und erh√∂ht den Z√§hler.
                data.lastVisit = serverTimestamp();
                data.visitCount = (data.visitCount || 0) + 1;

                await setDoc(docRef, data);
                console.log('‚úì Page visit tracked:', pageName);

            } catch (err) {
                console.error('‚úó Error tracking visit:', err);
            }
        }

        /**
         * Trackt die verbrachte Zeit und speichert sie in Firestore mittels Transaction.
         * @param {string} pageName - Der Name der aktuellen Seite/Aktivit√§t.
         */
        export async function trackTimeSpent(pageName) {
            if (!firebaseReady) return;
            const timeSpent = Math.floor((Date.now() - pageStartTime) / 1000); // Sekunden
            const docRef = getUserDocRef(pageName);
            if (!docRef) return;

            try {
                await runTransaction(db, async (transaction) => {
                    const sfDoc = await transaction.get(docRef);
                    // Erstellt Dokument, falls es nicht existiert (z.B. falls trackPageVisit fehlschlug)
                    const existingTime = sfDoc.exists() ? (sfDoc.data().timeSpent || 0) : 0;

                    const newTotalTime = existingTime + timeSpent;
                    transaction.set(docRef, { 
                        timeSpent: newTotalTime, 
                        lastActivityTime: serverTimestamp() 
                    }, { merge: true });
                });
                console.log('‚úì Time spent tracked (session):', timeSpent, 'seconds.');
            } catch (err) {
                console.warn('‚úó Transaction failed for time tracking:', err.message);
            }
        }

        /**
         * Trackt den Abschluss eines Quiz.
         */
        export async function trackQuizCompletion(pageName, correctAnswers, totalQuestions) {
            const docRef = getUserDocRef(pageName);
            if (!docRef) return;

            try {
                // Aktualisiert das Dokument mit den Quiz-Ergebnissen
                await updateDoc(docRef, {
                    quizCompleted: true,
                    quizScore: correctAnswers,
                    quizTotal: totalQuestions,
                    completionTime: serverTimestamp()
                });
                console.log('‚úì Quiz completion tracked:', correctAnswers, '/', totalQuestions);
            } catch (err) {
                console.error('‚úó Error tracking quiz completion:', err);
            }
        }

        /**
         * Speichert den aktuellen Fortschritt aller Aktivit√§ten ab.
         * @param {string} pageName - Der Name der aktuellen Seite.
         * @param {object} progressState - Der aktuelle Zustand des activitiesCompleted-Objekts.
         * @param {object} [extraData] - Zus√§tzliche Daten, z.B. der Zustand der Timeline.
         */
        export async function saveProgressState(pageName, progressState, extraData = {}) {
            const docRef = getUserDocRef(pageName);
            if (!docRef) return;
            
            const updatePayload = {
                activitiesProgress: progressState,
                lastActivityTime: serverTimestamp(),
                ...extraData
            };
            
            try {
                // Aktualisiert den gesamten Fortschrittszustand des Moduls
                await updateDoc(docRef, updatePayload);
                console.log('‚úì Activity progress state saved:', progressState);
            } catch (err) {
                // Fallback: Falls das Dokument nicht existiert, versuchen wir es mit setDoc zu erstellen
                console.warn('Document not found for update, trying setDoc fallback...');
                try {
                     await setDoc(docRef, {
                        pageName: pageName,
                        ...updatePayload,
                        firstVisit: serverTimestamp()
                    }, { merge: true });
                    console.log('‚úì Activity progress saved via setDoc fallback.');
                } catch(setErr) {
                     console.error('‚úó Error saving progress (setDoc fallback failed):', setErr);
                }
            }
        }
        
        /**
         * L√§dt den gespeicherten Fortschritt aus Firestore und wendet ihn auf die UI an.
         */
        export async function loadProgressAndInitializeUI() {
            if (!firebaseReady) {
                return;
            }
            const docRef = getUserDocRef(PAGE_NAME);
            if (!docRef) return;

            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && docSnap.data().activitiesProgress) {
                    const data = docSnap.data();
                    const loadedProgress = data.activitiesProgress;
                    const loadedTimeline = data.timelineState || {}; // Timeline-Zustand laden
                    
                    console.log('‚úì Progress geladen:', loadedProgress);
                    console.log('‚úì Timeline-Zustand geladen:', loadedTimeline);

                    // Aufruf der globalen Funktion in der Hauptlogik
                    if (window.applyLoadedProgress) {
                        window.applyLoadedProgress(loadedProgress, loadedTimeline);
                    }
                }
            } catch (err) {
                console.error('‚úó Fehler beim Laden des Fortschritts:', err);
            }
        }

        // Exponiere die Funktionen global, damit sie im restlichen Script aufgerufen werden k√∂nnen
        window.trackPageVisit = trackPageVisit;
        window.trackTimeSpent = trackTimeSpent;
        window.trackQuizCompletion = trackQuizCompletion;
        window.saveProgressState = saveProgressState; 
        window.loadProgressAndInitializeUI = loadProgressAndInitializeUI; 
    </script>

    <!-- HIER BEGINNT DER HAUPT-JAVASCRIPT-BLOCK OHNE MODULE IMPORTS -->
    <script>
        // === QUIZ / SPIELLOGIK (FUNKTIONIERT WIE VOM BENUTZER ERSTELLT) ===

        const PAGE_NAME = 'artikel3'; 
        
        let activitiesCompleted = {
            timeline: false,
            comparison: false,
            facts: false
        };

        // === ZUS√ÑTZLICHE FUNKTION ZUM ANWENDEN DES GELADENEN FORTSCHRITTS ===
        window.applyLoadedProgress = function(progress, timelineState) {
            // 1. Internen Zustand aktualisieren
            activitiesCompleted = progress;
            console.log('UI-Zustand angewendet:', activitiesCompleted);
            
            // 2. UI-Elemente freischalten basierend auf dem Zustand
            
            // --- Timeline-Status wiederherstellen ---
            if (timelineState && Object.keys(timelineState).length > 0) {
                 // Setze den Zustand der Drop-Zonen und Chips
                 restoreTimelineState(timelineState);
            }
            
            if (progress.timeline) {
                // Timeline ist abgeschlossen -> Comparison freischalten & Timeline sperren
                unlockComparison(true);
                // Timeline Sektion visuell als erledigt markieren/sperren
                const timelineSection = document.getElementById('timeline-section-main');
                if(timelineSection) {
                    // Verhindert Interaktion mit der abgeschlossenen Timeline
                    timelineSection.style.opacity = '0.7'; 
                    timelineSection.style.pointerEvents = 'none';
                    document.getElementById('check-timeline').style.display = 'none';
                }
            }
            if (progress.comparison) {
                // Comparison ist abgeschlossen -> Facts freischalten
                unlockFacts(true);
                 // Sperre die gesamte Vergleichssektion (da abgeschlossen)
                const comparisonSection = document.getElementById('comparison-section');
                comparisonSection.style.opacity = '0.7'; 
                comparisonSection.style.pointerEvents = 'none';
            }
            if (progress.facts) {
                // Facts ist abgeschlossen -> Quiz freischalten
                unlockQuiz(true);
                 // Sperre die gesamte Faktencheck-Sektion (da abgeschlossen)
                const factsSection = document.getElementById('facts-section');
                factsSection.style.opacity = '0.7'; 
                factsSection.style.pointerEvents = 'none';
            }
        };

        // === TIMELINE DRAG & DROP ===
        let draggedElement = null;
        // Speichert nur die Platzierungen: { country: year, ... }
        const placedCountries = {}; 

        function setupDragAndDrop() {
            // Setup draggable chips
            document.querySelectorAll('.country-chip').forEach(chip => {
                chip.draggable = true;
                chip.style.cursor = 'grab';
                chip.classList.remove('placed', 'dragging');

                chip.addEventListener('dragstart', function(e) {
                    if (activitiesCompleted.timeline) {
                        e.preventDefault();
                        return;
                    }

                    // 1. Wenn der Chip bereits in einer Zone ist, wird er von dort "freigezogen"
                    const currentZone = this.closest('.drop-zone');
                    if (currentZone) {
                        const country = this.dataset.country;
                        // Entferne den Chip aus der Datenstruktur
                        delete placedCountries[country];
                        // Entferne den Chip visuell aus der Dropzone
                        currentZone.querySelector('.drop-zone-content').removeChild(this); 
                        // Setze den originalen Chip im Pool wieder auf sichtbar und ziehbar
                        const originalChipInPool = document.querySelector(`#countries-pool .country-chip[data-country="${country}"]`);
                        if(originalChipInPool) {
                             originalChipInPool.style.display = 'block';
                             originalChipInPool.classList.remove('placed');
                             originalChipInPool.draggable = true;
                        }
                    }

                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    
                    // Speichere den Zwischenstand nach dem Freiziehen
                    if (window.saveProgressState) window.saveProgressState(PAGE_NAME, activitiesCompleted, { timelineState: placedCountries });
                    updateTimelineProgress();
                });

                chip.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    draggedElement = null;
                });
            });

            // Setup drop zones (Unver√§ndert, Drag/Drop Logic)
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over', 'correct', 'incorrect');
                
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    const content = this.querySelector('.drop-zone-content');
                    // Zone nur erlauben, wenn sie leer ist
                    if (!content.querySelector('.country-chip') && draggedElement) {
                        this.classList.add('drag-over');
                    } else {
                         this.classList.remove('drag-over');
                    }
                });

                zone.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });

                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    if (!draggedElement) return;
                    
                    const content = this.querySelector('.drop-zone-content');
                    if (content.querySelector('.country-chip')) return;
                    
                    // Der Chip, der gerade gezogen wird (entweder aus dem Pool oder einer anderen Zone)
                    const chipToPlace = draggedElement;
                    
                    // 1. Neuen Chip-Klon in die Dropzone setzen
                    const clone = chipToPlace.cloneNode(true);
                    clone.draggable = true; // Erlaubt erneutes Ziehen aus der Drop-Zone
                    clone.style.cursor = 'move';
                    clone.classList.remove('dragging');
                    content.appendChild(clone);
                    
                    // 2. Originalen Chip im Pool (falls von dort gezogen) als platziert markieren (visuell entfernen)
                    const country = chipToPlace.dataset.country;

                    const originalInPool = document.querySelector(`#countries-pool .country-chip[data-country="${country}"]`);
                    if (originalInPool) {
                        originalInPool.classList.add('placed');
                        originalInPool.style.display = 'none';
                    }
                    
                    // 3. Daten speichern
                    const year = this.dataset.year;
                    placedCountries[country] = year; // Speichere country -> year
                    
                    // 4. UI und Tracking aktualisieren
                    updateTimelineProgress();
                    // Speichere den Zwischenstand
                    if (window.saveProgressState) window.saveProgressState(PAGE_NAME, activitiesCompleted, { timelineState: placedCountries });

                    
                    const checkBtn = document.getElementById('check-timeline');
                    if (Object.keys(placedCountries).length === 6) {
                        checkBtn.disabled = false;
                        checkBtn.style.opacity = '1';
                        checkBtn.style.background = '#5eb9b4';
                    }
                    
                    draggedElement = null;
                });
            });
        }
        
        /**
         * Stellt den Zustand der Timeline (Chips in Drop-Zonen) beim Laden wieder her.
         */
        function restoreTimelineState(timelineState) {
            const pool = document.getElementById('countries-pool');

            for (const country in timelineState) {
                const year = timelineState[country];
                const originalChip = document.querySelector(`#countries-pool .country-chip[data-country="${country}"]`);
                const dropZone = document.querySelector(`.drop-zone[data-year="${year}"] .drop-zone-content`);

                if (originalChip && dropZone) {
                    // 1. Original-Chip im Pool verstecken
                    originalChip.classList.add('placed');
                    originalChip.style.display = 'none';

                    // 2. Klon in Drop-Zone erstellen
                    const clone = originalChip.cloneNode(true);
                    clone.draggable = true; // Wieder ziehbar machen
                    clone.style.cursor = 'move';
                    clone.classList.remove('dragging', 'placed');
                    clone.style.opacity = '1'; // Sichtbarkeit in Drop-Zone sicherstellen
                    dropZone.appendChild(clone);

                    // 3. Daten in den lokalen Zustand √ºbernehmen
                    placedCountries[country] = year;
                }
            }
            updateTimelineProgress();
        }


        function updateTimelineProgress() {
            const count = Object.keys(placedCountries).length;
            document.getElementById('timeline-progress').textContent = `${count} von 6 L√§ndern zugeordnet`;
        }

        window.checkTimeline = function() {
            let allCorrect = true;
            const dropZones = document.querySelectorAll('.drop-zone');
            
            dropZones.forEach(zone => {
                const year = zone.dataset.year;
                const content = zone.querySelector('.drop-zone-content');
                const chip = content.querySelector('.country-chip');
                
                if (chip) {
                    const correctYear = chip.dataset.year;
                    
                    if (correctYear === year) {
                        zone.classList.add('correct');
                        zone.classList.remove('incorrect');
                    } else {
                        zone.classList.add('incorrect');
                        zone.classList.remove('correct');
                        allCorrect = false;
                    }
                }
            });

            const feedback = document.getElementById('timeline-feedback');
            const checkBtn = document.getElementById('check-timeline');
            
            if (allCorrect) {
                feedback.className = 'timeline-feedback correct show';
                feedback.innerHTML = '‚úì Perfekt! Alle L√§nder wurden korrekt zugeordnet. Diese L√§nder haben √ºber einen Zeitraum von 42 Jahren die Erbschaftssteuer abgeschafft.';
                activitiesCompleted.timeline = true;
                
                // Setzt die Timeline Sektion auf gel√∂st
                document.getElementById('timeline-section-main').style.opacity = '0.7'; 
                document.getElementById('timeline-section-main').style.pointerEvents = 'none';

                // TRACKING: Speichere den gesamten Fortschrittszustand (FIREBASE)
                // Hier wird timelineState nicht mehr ben√∂tigt, da abgeschlossen.
                if (window.saveProgressState) window.saveProgressState(PAGE_NAME, activitiesCompleted); 
                
                setTimeout(() => {
                    unlockComparison();
                    checkBtn.style.display = 'none';
                }, 1500);
            } else {
                feedback.className = 'timeline-feedback incorrect show';
                feedback.innerHTML = '‚úó Nicht ganz. Einige Zuordnungen sind noch nicht korrekt. Versuchen Sie es erneut!<br><small style="margin-top: 10px; display: block;">Tipp: Verschieben Sie falsch platzierte Chips aus der Zone zur√ºck in den Pool oder in eine neue Zone.</small>';
                
                // Beim Fehler wird nicht automatisch zur√ºckgesetzt, damit der Nutzer die Chips korrigieren kann
                // Aber der Check-Button wird wieder aktiviert, falls er disabled war.
                checkBtn.disabled = false;
                checkBtn.style.opacity = '1';
                checkBtn.style.background = '#5eb9b4';
            }
        }

        function resetTimeline() {
            // ... (optional: k√∂nnte entfernt werden, da der Benutzer nun manuell korrigieren kann)
        }

        // isInitialLoad Flag hinzugef√ºgt
        function unlockComparison(isInitialLoad = false) {
            const comparisonSection = document.getElementById('comparison-section');
            if (!comparisonSection) return;
            
            comparisonSection.classList.add('unlocked');
            
            if (!isInitialLoad) {
                // Scroll only, if it's not the initial load
                setTimeout(() => {
                    const yOffset = -100;
                    const y = comparisonSection.getBoundingClientRect().top + window.pageYOffset + yOffset;
                    window.scrollTo({top: y, behavior: 'smooth'});
                }, 100);
                
                // Add visual badge only on completion
                const badge = createUnlockBadge('üîì L√§ndervergleich freigeschaltet!');
                
                const timelineSection = document.getElementById('timeline-section-main');
                if (timelineSection) {
                    timelineSection.appendChild(badge);
                }
            }
        }

        // === L√ÑNDERVERGLEICH ===
        // Da es sich um Auswahlfragen handelt, wird answeredComparisons beim Laden NICHT angewendet, 
        // da der Zustand der Karten beim Neuladen verloren geht und neu geklickt werden m√ºsste,
        // was die Benutzererfahrung verschlechtert. Wir verlassen uns hier auf den `activitiesCompleted.comparison` Flag.
        let answeredComparisons = new Set(); 
        const totalComparisons = 3;

        document.querySelectorAll('.country-card').forEach(card => {
            card.addEventListener('click', function() {
                const grid = this.closest('.comparison-grid');
                if (!grid) return;
                
                const questionRef = grid.dataset.questionRef;
                const question = document.querySelector(`.comparison-question[data-question="${questionRef}"]`);
                if (!question) return;
                
                const questionNum = question.dataset.question;
                // Deaktiviert das Klicken, wenn die Aktivit√§t abgeschlossen ist
                if (activitiesCompleted.comparison || answeredComparisons.has(questionNum)) return;
                
                const correctAnswer = question.dataset.correct;
                const userAnswer = this.dataset.answer;
                const feedback = document.getElementById(`comparison-feedback-${questionNum}`);
                
                const allCards = grid.querySelectorAll('.country-card');
                allCards.forEach(c => c.style.pointerEvents = 'none');
                
                this.classList.add('selected');
                
                setTimeout(() => {
                    if (userAnswer === correctAnswer) {
                        feedback.className = 'comparison-feedback correct show';
                        feedback.textContent = '‚úì Richtig! ' + getComparisonFeedback(questionNum);
                    } else {
                        feedback.className = 'comparison-feedback incorrect show';
                        feedback.textContent = '‚úó Nicht ganz. ' + getComparisonFeedback(questionNum);
                        allCards.forEach(c => {
                            if (c.dataset.answer === correctAnswer) {
                                c.classList.add('selected'); // Highlight correct answer
                            }
                        });
                    }
                    
                    answeredComparisons.add(questionNum);
                    updateComparisonProgress();
                    
                    if (answeredComparisons.size === totalComparisons && !activitiesCompleted.comparison) {
                        activitiesCompleted.comparison = true;
                        
                        // TRACKING: Speichere den gesamten Fortschrittszustand (FIREBASE)
                        if (window.saveProgressState) window.saveProgressState(PAGE_NAME, activitiesCompleted);
                        
                        setTimeout(() => {
                            unlockFacts();
                            // Sperre die gesamte Vergleichssektion nach Abschluss, um Doppel-Klicks zu verhindern
                            const comparisonSection = document.getElementById('comparison-section');
                            comparisonSection.style.opacity = '0.7'; 
                            comparisonSection.style.pointerEvents = 'none';
                        }, 1500);
                    }
                }, 500);
            });
        });

        function updateComparisonProgress() {
            document.getElementById('comparison-progress').textContent = `${answeredComparisons.size} von ${totalComparisons} Fragen beantwortet`;
        }

        function getComparisonFeedback(questionNum) {
            const feedbacks = {
                '1': 'Schweden schaffte 2004 unter sozialdemokratischer Regierung die Erbschaftssteuer ab, weil Ausnahmen dazu f√ºhrten, dass die Mittelklasse die Hauptlast trug.',
                '2': '√ñsterreich f√ºhrte 1759 zur Finanzierung des Siebenj√§hrigen Krieges eine der ersten Erbschaftssteuern ein.',
                '3': 'Die Schweiz ist mit ihrer Doppelbesteuerung (Verm√∂gen UND Erbe) fast weltweit einzigartig ‚Äì die meisten L√§nder haben nur eine der beiden Steuern.'
            };
            return feedbacks[questionNum] || '';
        }

        // isInitialLoad Flag hinzugef√ºgt
        function unlockFacts(isInitialLoad = false) {
            const factsSection = document.getElementById('facts-section');
            if (!factsSection) return;
            
            factsSection.classList.add('unlocked');
            
            if (!isInitialLoad) {
                // Scroll only, if it's not the initial load
                setTimeout(() => {
                    const yOffset = -100;
                    const y = factsSection.getBoundingClientRect().top + window.pageYOffset + yOffset;
                    window.scrollTo({top: y, behavior: 'smooth'});
                }, 100);
                
                const badge = createUnlockBadge('üîì Faktencheck freigeschaltet!');
                
                const comparisonSection = document.getElementById('comparison-section');
                if (comparisonSection) {
                    comparisonSection.appendChild(badge);
                }
            }
        }

        // === FAKTENCHECK ===
        // Hier lassen wir answeredFacts beim Laden NICHT persistieren, 
        // da die Logik nur pr√ºft, ob die gesamte Aktivit√§t abgeschlossen ist.
        let answeredFacts = new Set(); 
        const totalFacts = 4;

        document.querySelectorAll('.fact-card').forEach(card => {
            const buttons = card.querySelectorAll('.fact-btn');
            const factNum = card.dataset.fact;
            const isCorrect = card.dataset.correct === 'true';

            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    if (activitiesCompleted.facts || answeredFacts.has(factNum)) return;

                    const userAnswer = this.dataset.answer === 'true';
                    const feedback = card.querySelector('.fact-feedback');
                    const answerCorrect = userAnswer === isCorrect;

                    buttons.forEach(btn => btn.disabled = true);
                    
                    if (answerCorrect) {
                        this.classList.add('correct');
                        feedback.className = 'fact-feedback correct show';
                        feedback.textContent = '‚úì Richtig! ' + getFactFeedback(factNum);
                    } else {
                        this.classList.add('incorrect');
                        buttons.forEach(btn => {
                            if ((btn.dataset.answer === 'true') === isCorrect) {
                                btn.classList.add('correct');
                            }
                        });
                        feedback.className = 'fact-feedback incorrect show';
                        feedback.textContent = '‚úó Falsch. ' + getFactFeedback(factNum);
                    }

                    answeredFacts.add(factNum);
                    updateFactsProgress();

                    if (answeredFacts.size === totalFacts && !activitiesCompleted.facts) {
                        activitiesCompleted.facts = true;

                        // Sperre die gesamte Faktencheck-Sektion
                        const factsSection = document.getElementById('facts-section');
                        factsSection.style.opacity = '0.7'; 
                        factsSection.style.pointerEvents = 'none';
                        
                        // TRACKING: Speichere den gesamten Fortschrittszustand (FIREBASE)
                        if (window.saveProgressState) window.saveProgressState(PAGE_NAME, activitiesCompleted);
                        
                        setTimeout(() => {
                            unlockQuiz();
                        }, 1500);
                    }
                });
            });
        });

        function updateFactsProgress() {
            document.getElementById('facts-progress').textContent = `${answeredFacts.size} von ${totalFacts} Aussagen beantwortet`;
        }

        function getFactFeedback(factNum) {
            const feedbacks = {
                '1': '√ñsterreich 1759 (Siebenj√§hriger Krieg) und Grossbritannien 1796 (Krieg gegen Napoleon) sind historische Beispiele.',
                '2': 'Falsch! Etwa 50% der L√§nder weltweit kennen heute noch eine Form der Erbschaftssteuer.',
                '3': 'Richtig! Dieser drastische R√ºckgang zeigt die geringe Bedeutung von Erbschaftssteuern in den meisten OECD-L√§ndern heute.',
                '4': 'Richtig! Laura Seelkopf bezeichnet diese Kombination als ¬´sehr ungew√∂hnlich¬ª und weltweit einzigartig.'
            };
            return feedbacks[factNum] || '';
        }

        // isInitialLoad Flag hinzugef√ºgt
        function unlockQuiz(isInitialLoad = false) {
            const quizSection = document.getElementById('quiz-section');
            if (!quizSection) return;
            
            quizSection.classList.remove('locked');
            
            if (!isInitialLoad) {
                // Scroll only, if it's not the initial load
                setTimeout(() => {
                    const yOffset = -100;
                    const y = quizSection.getBoundingClientRect().top + window.pageYOffset + yOffset;
                    window.scrollTo({top: y, behavior: 'smooth'});
                }, 100);
                
                const badge = createUnlockBadge('üîì Quiz freigeschaltet!');
                
                const factsSection = document.getElementById('facts-section');
                if (factsSection) {
                    factsSection.appendChild(badge);
                }
            }
        }
        
        function createUnlockBadge(text) {
             const badge = document.createElement('div');
             badge.className = 'unlock-badge';
             badge.textContent = text;
             badge.style.marginTop = '20px';
             badge.style.animation = 'slideIn 0.5s ease-out';
             return badge;
        }

        // === QUIZ ===
        let currentQuestion = 1;
        let answeredQuestions = new Set();
        let correctQuizAnswers = 0;
        const totalQuestions = 6;

        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', function() {
                const question = this.closest('.question');
                const questionNum = question.dataset.question;
                const options = question.querySelectorAll('.option');
                const feedback = question.querySelector('.feedback');
                const nextButton = question.querySelector('.next-button');
                
                if (answeredQuestions.has(questionNum)) return;
                
                options.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                
                const isCorrect = this.dataset.answer === 'correct';
                
                // Disable all options after selection
                options.forEach(opt => opt.style.pointerEvents = 'none');

                setTimeout(() => {
                    if (isCorrect) {
                        this.classList.add('correct');
                        feedback.className = 'feedback correct show';
                        feedback.textContent = '‚úì Richtig! ' + getCorrectFeedback(questionNum);
                        correctQuizAnswers++;
                    } else {
                        this.classList.add('incorrect');
                        options.forEach(opt => {
                            if (opt.dataset.answer === 'correct') {
                                opt.classList.add('correct');
                            }
                        });
                        feedback.className = 'feedback incorrect show';
                        feedback.textContent = '‚úó Nicht ganz. ' + getCorrectFeedback(questionNum);
                    }
                    
                    question.classList.add('answered');
                    answeredQuestions.add(questionNum);
                    nextButton.classList.add('show');
                    updateProgress();
                }, 300);
            });
        });

        window.showNextQuestion = function() {
            const currentQ = document.querySelector(`.question.active`);
            if (currentQ) {
                currentQ.classList.remove('active');
            }
            
            currentQuestion++;
            
            if (currentQuestion <= totalQuestions) {
                const nextQ = document.querySelector(`[data-question="${currentQuestion}"]`);
                if (nextQ) {
                    nextQ.classList.add('active');
                }
            } else {
                // Quiz abgeschlossen
                document.getElementById('completion-message').classList.add('show');
                
                // Tracking: Quiz Completion (FIREBASE)
                if (window.trackQuizCompletion) window.trackQuizCompletion(PAGE_NAME, correctQuizAnswers, totalQuestions);
                
                // Tracking: Time Spent (FIREBASE)
                if (window.trackTimeSpent) window.trackTimeSpent(PAGE_NAME);
            }
        }

        function updateProgress() {
            const progress = (answeredQuestions.size / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('quiz-progress').textContent = `${answeredQuestions.size}/${totalQuestions}`;
        }

        function getCorrectFeedback(questionNum) {
            const feedbacks = {
                '1': '√ñsterreich f√ºhrte sie 1759 zur Finanzierung des Siebenj√§hrigen Krieges ein, Grossbritannien 1796 im Krieg gegen Napoleon.',
                '2': 'Praktisch kein anderes Land hat beide Steuern ‚Äì die meisten kennen entweder die eine oder die andere Variante.',
                '3': 'In Schweden schaffte ausgerechnet eine sozialdemokratische Regierung die Erbschaftssteuer ab ‚Äì nachdem Ausnahmen dazu f√ºhrten, dass die Mittelklasse die Hauptlast trug.',
                '4': 'Dieser drastische R√ºckgang zeigt die geringe Bedeutung von Erbschaftssteuern in den meisten OECD-L√§ndern heute.',
                '5': 'Seelkopf findet ein anderes Design geeigneter: eine moderate Steuer schon ab moderaten Summen.',
                '6': 'Die genannten Gr√ºnde sind: fehlende Dringlichkeit in Friedenszeiten, praktische Probleme, unfaire Lastverteilung und zunehmende Kapitalmobilit√§t.'
            };
            return feedbacks[questionNum] || '';
        }

        // === BEIM LADEN ===
        window.addEventListener('load', () => {
            // Randomize country chips order
            const pool = document.getElementById('countries-pool');
            if (pool) {
                const chips = Array.from(pool.children);
                
                // Fisher-Yates shuffle
                for (let i = chips.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [chips[i], chips[j]] = [chips[j], chips[i]];
                }
                
                // Clear and re-append in random order
                pool.innerHTML = '';
                chips.forEach(chip => pool.appendChild(chip));
            }
            
            setupDragAndDrop();
            
            // Check button initial state
            const checkBtn = document.getElementById('check-timeline');
            if (checkBtn) {
                // Setzt den Button auf disabled, WENN noch nichts platziert wurde
                checkBtn.disabled = Object.keys(placedCountries).length !== 6;
                checkBtn.style.opacity = checkBtn.disabled ? '0.5' : '1';
                checkBtn.style.background = checkBtn.disabled ? '#ccc' : '#5eb9b4';
            }
            
            // Lade den Fortschritt erst, wenn das gesamte DOM geladen ist.
            // Der Aufruf zur eigentlichen Ladefunktion findet im Module-Script nach Auth statt.
        });

        // === BEIM VERLASSEN ===
        window.addEventListener('beforeunload', () => {
            // Tracking: Time Spent (FIREBASE)
            if (window.trackTimeSpent) window.trackTimeSpent(PAGE_NAME);
        });
    </script>
</body>
</html>
